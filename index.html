<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»™å®¶å†›æ±‚ç”Ÿè®°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: rgba(20, 20, 40, 0.95);
            border: 3px solid #667eea;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
            max-width: 900px;
            width: 100%;
            padding: 30px;
            color: #e0e0e0;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
        }

        .header h1 {
            color: #64b5f6;
            font-size: 2.5em;
            text-shadow: 0 0 10px rgba(100, 181, 246, 0.5);
            margin-bottom: 10px;
        }

        .game-section {
            display: none;
        }

        .game-section.active {
            display: block;
        }

        /* è§’è‰²é€‰æ‹©é¡µé¢ */
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .character-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.8);
            border-color: #64b5f6;
        }

        .character-card h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .character-card p {
            font-size: 0.9em;
            color: #b0bec5;
            margin-bottom: 5px;
            line-height: 1.6;
        }

        /* åŠ ç‚¹ç³»ç»Ÿ */
        .stat-system {
            background: rgba(30, 60, 114, 0.5);
            border: 1px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }

        .stat-label {
            color: #64b5f6;
            font-weight: bold;
            min-width: 100px;
        }

        .stat-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-btn {
            background: #667eea;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .stat-btn:hover {
            background: #64b5f6;
            transform: scale(1.1);
        }

        .stat-value {
            min-width: 30px;
            text-align: center;
            color: #ffd54f;
            font-weight: bold;
        }

        .points-remaining {
            color: #ffd54f;
            font-weight: bold;
            text-align: right;
            margin-bottom: 15px;
        }

        /* æ¸¸æˆä¸»ç•Œé¢ */
        .game-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #667eea;
            border-radius: 5px;
            padding: 12px;
            text-align: center;
        }

        .info-label {
            color: #b0bec5;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .info-value {
            color: #64b5f6;
            font-weight: bold;
            font-size: 1.3em;
        }

        .health-bar, .hunger-bar, .thirst-bar {
            background: #1a1a2e;
            border: 1px solid #667eea;
            border-radius: 3px;
            height: 20px;
            overflow: hidden;
            margin-top: 5px;
        }

        .health-fill {
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            height: 100%;
            transition: width 0.3s ease;
        }

        .hunger-fill {
            background: linear-gradient(90deg, #ff9800, #ffc107);
            height: 100%;
            transition: width 0.3s ease;
        }

        .thirst-fill {
            background: linear-gradient(90deg, #2196f3, #64b5f6);
            height: 100%;
            transition: width 0.3s ease;
        }

        /* æ•…äº‹æ–‡æœ¬ */
        .story-text {
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid #ffd54f;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            color: #e0e0e0;
            line-height: 1.8;
            font-size: 1.05em;
            min-height: 150px;
        }

        /* é€‰é¡¹æŒ‰é’® */
        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 2px solid #667eea;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s ease;
            text-align: center;
            white-space: wrap;
        }

        .btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
            border-color: #f44336;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #e91e63 0%, #f44336 100%);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.5);
        }

        .btn-success {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            border-color: #4caf50;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #45a049 0%, #4caf50 100%);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.5);
        }

        /* ç‰©å“æ  */
        .inventory {
            background: rgba(30, 60, 114, 0.5);
            border: 1px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .inventory-title {
            color: #64b5f6;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .inventory-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }

        .item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #667eea;
            border-radius: 5px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .item:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #64b5f6;
        }

        .item-name {
            color: #64b5f6;
            font-weight: bold;
        }

        .item-count {
            color: #ffd54f;
            font-size: 0.8em;
        }

        /* ç»“å±€å±å¹• */
        .ending-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .ending-title {
            color: #ffd54f;
            font-size: 2.2em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 213, 79, 0.5);
        }

        .ending-content {
            color: #e0e0e0;
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .ending-content.good {
            color: #4caf50;
        }

        .ending-content.bad {
            color: #f44336;
        }

        /* å¯¹è¯æ¡† */
        .dialog-box {
            background: rgba(30, 30, 50, 0.9);
            border: 2px solid #ffd54f;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .dialog-name {
            color: #ffd54f;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .dialog-text {
            color: #e0e0e0;
            line-height: 1.6;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .character-grid {
                grid-template-columns: 1fr;
            }

            .game-info {
                grid-template-columns: repeat(2, 1fr);
            }

            .options-container {
                grid-template-columns: 1fr;
            }

            .stat-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        .hidden {
            display: none;
        }

        .combat-log {
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid #f44336;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.95em;
            max-height: 200px;
            overflow-y: auto;
            color: #e0e0e0;
        }

        .combat-log-item {
            margin-bottom: 8px;
            padding: 5px;
            border-bottom: 1px solid rgba(244, 67, 54, 0.2);
        }

        .combat-log-item:last-child {
            border-bottom: none;
        }

        .damage {
            color: #f44336;
        }

        .heal {
            color: #4caf50;
        }

        .buff {
            color: #64b5f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ä»™å®¶å†›æ±‚ç”Ÿè®° </h1>
        </div>

        <!-- å¼€å§‹é¡µé¢ -->
        <div id="startSection" class="game-section active">
            <div style="text-align: center; margin-bottom: 30px;">
                <p style="color: #b0bec5; font-size: 1.1em; line-height: 1.8; margin-bottom: 20px;">
                    æ›¾ç»ï¼Œä»™åº­çš„å®¶å›­ç¹è£æ˜Œç››ã€‚ä½†åœ¨ä¸€ä¸ªæœˆé»‘é£é«˜çš„å¤œæ™šï¼Œ<br>
                    çš±çš®å¤§ç‹ç‡é¢†å¦–é­”å¤§å†›æ‘§æ¯äº†ä»™å®¶å†›çš„ä¸€åˆ‡ã€‚<br>
                    <span style="color: #ffd54f;">å®¶å›­å·²æ¯ï¼Œå¤ä»‡ä¹‹å¿µç‡ƒçƒ§åœ¨å¿ƒé—´...</span>
                </p>
                <p style="color: #64b5f6; font-size: 0.95em;">é€‰æ‹©ä½ çš„è§’è‰²ï¼Œè¸ä¸Šå¤ä»‡ä¹‹æ—…</p>
            </div>

            <div class="character-grid">
                <div class="character-card" onclick="selectCharacter('emperor')">
                    <h3>ğŸ‘‘ è¯¸å¤©æœªæ¥ä»™å¸</h3>
                    <p><strong>å¤©ç”Ÿè¡€è„‰å¼ºå¤§</strong></p>
                    <p style="color: #64b5f6;">ä½“è´¨ï¼š+15%</p>
                    <p style="color: #64b5f6;">æ”»å‡»ï¼š+10%</p>
                    <p style="color: #b0bec5; margin-top: 10px; font-size: 0.85em;">
                        æ›¾ç»ä»™åº­æœ€æœ‰å¤©èµ‹çš„ä¿®å£«ï¼Œè™½ç„¶è¿˜æœªçªç ´ä»™å¸å¢ƒç•Œï¼Œä½†å·²æœ‰ä»™å¸ä¹‹èµ„ã€‚
                    </p>
                </div>

                <div class="character-card" onclick="selectCharacter('young')">
                    <h3>ğŸŒŸ æ²³åŒ—å°æ¨</h3>
                    <p><strong>æ•æ·ä¸”å¹¸è¿</strong></p>
                    <p style="color: #64b5f6;">æ•æ·ï¼š+20%</p>
                    <p style="color: #64b5f6;">å¹¸è¿ï¼š+25%</p>
                    <p style="color: #b0bec5; margin-top: 10px; font-size: 0.85em;">
                        çµæ•èªæ…§ï¼Œè™½ç„¶ä¿®ä¸ºæœ€æµ…ï¼Œä½†æœºæ™ºè¿‡äººï¼Œå¸¸èƒ½åŒ–é™©ä¸ºå¤·ã€‚
                    </p>
                </div>

                <div class="character-card" onclick="selectCharacter('liu')">
                    <h3>âš¡ åˆ˜ä¸–é¹</h3>
                    <p><strong>åŠ›é‡ä¸æ„å¿—</strong></p>
                    <p style="color: #64b5f6;">åŠ›é‡ï¼š+20%</p>
                    <p style="color: #64b5f6;">æ„å¿—ï¼š+15%</p>
                    <p style="color: #b0bec5; margin-top: 10px; font-size: 0.85em;">
                        é“è¡€æˆ˜å£«ï¼Œä»¥å…¶é¡½å¼ºæ„å¿—å’ŒæƒŠäººçš„åŠ›é‡è‘—ç§°ï¼Œæ›¾ç‹¬è‡ªå¯¹æŠ—ç™¾å¦–ã€‚
                    </p>
                </div>
            </div>
        </div>

        <!-- åŠ ç‚¹é¡µé¢ -->
        <div id="allocateSection" class="game-section">
            <h2 style="color: #64b5f6; margin-bottom: 20px; text-align: center;">
                åˆ†é…å±æ€§ç‚¹
            </h2>
            
            <div class="points-remaining">
                å‰©ä½™ç‚¹æ•°: <span id="remainingPoints">10</span>
            </div>

            <div class="stat-system">
                <div class="stat-item">
                    <div class="stat-label">ä½“è´¨ (HP)</div>
                    <div class="stat-controls">
                        <button class="stat-btn" onclick="decreaseStat('constitution')">-</button>
                        <div class="stat-value" id="constitution-value">0</div>
                        <button class="stat-btn" onclick="increaseStat('constitution')">+</button>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">åŠ›é‡ (æ”»å‡»)</div>
                    <div class="stat-controls">
                        <button class="stat-btn" onclick="decreaseStat('strength')">-</button>
                        <div class="stat-value" id="strength-value">0</div>
                        <button class="stat-btn" onclick="increaseStat('strength')">+</button>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">æ•æ· (é˜²å¾¡/èº²é¿)</div>
                    <div class="stat-controls">
                        <button class="stat-btn" onclick="decreaseStat('agility')">-</button>
                        <div class="stat-value" id="agility-value">0</div>
                        <button class="stat-btn" onclick="increaseStat('agility')">+</button>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">æ™ºæ…§ (æ²»ç–—/æ¢å¤)</div>
                    <div class="stat-controls">
                        <button class="stat-btn" onclick="decreaseStat('wisdom')">-</button>
                        <div class="stat-value" id="wisdom-value">0</div>
                        <button class="stat-btn" onclick="increaseStat('wisdom')">+</button>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-label">æ„å¿— (æŠ—æ€§/æ¢å¤é€Ÿåº¦)</div>
                    <div class="stat-controls">
                        <button class="stat-btn" onclick="decreaseStat('willpower')">-</button>
                        <div class="stat-value" id="willpower-value">0</div>
                        <button class="stat-btn" onclick="increaseStat('willpower')">+</button>
                    </div>
                </div>
            </div>

            <p style="color: #b0bec5; text-align: center; margin-bottom: 20px; font-size: 0.9em;">
                ğŸ’¡ æç¤ºï¼šå»ºè®®æ ¹æ®è§’è‰²ç‰¹æ€§åŠ ç‚¹ï¼Œä»¥å‘æŒ¥å„è‡ªä¼˜åŠ¿
            </p>

            <div class="options-container">
                <button class="btn" onclick="goBack()">è¿”å›é€‰æ‹©è§’è‰²</button>
                <button class="btn btn-success" onclick="startGame()">å¼€å§‹å†’é™©</button>
            </div>
        </div>

        <!-- æ¸¸æˆä¸»ç•Œé¢ -->
        <div id="gameSection" class="game-section">
            <!-- è§’è‰²ä¿¡æ¯ -->
            <div class="game-info">
                <div class="info-box">
                    <div class="info-label">ç”Ÿå‘½å€¼</div>
                    <div class="info-value" id="health-display">100/100</div>
                    <div class="health-bar">
                        <div class="health-fill" id="health-bar" style="width: 100%"></div>
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-label">é¥±é£Ÿåº¦</div>
                    <div class="info-value" id="hunger-display">100/100</div>
                    <div class="hunger-bar">
                        <div class="hunger-fill" id="hunger-bar" style="width: 100%"></div>
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-label">æ¸´æœ›åº¦</div>
                    <div class="info-value" id="thirst-display">100/100</div>
                    <div class="thirst-bar">
                        <div class="thirst-fill" id="thirst-bar" style="width: 100%"></div>
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-label">æ—¥æœŸ</div>
                    <div class="info-value" id="day-display">ç¬¬ 1 å¤©</div>
                </div>

                <div class="info-box">
                    <div class="info-label">ä½ç½®</div>
                    <div class="info-value" id="location-display">åºŸå¢Ÿ</div>
                </div>

                <div class="info-box">
                    <div class="info-label">çŠ¶æ€</div>
                    <div class="info-value" id="status-display">æ­£å¸¸</div>
                </div>
            </div>

            <!-- æ•…äº‹æ–‡æœ¬ -->
            <div class="story-text" id="storyText">
                æ•…äº‹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>

            <!-- æˆ˜æ–—æ—¥å¿— -->
            <div class="combat-log" id="combatLog" style="display: none;">
                <div style="color: #64b5f6; font-weight: bold; margin-bottom: 10px;">âš”ï¸ æˆ˜æ–—æ—¥å¿—</div>
                <div id="combatLogContent"></div>
            </div>

            <!-- ç‰©å“æ  -->
            <div class="inventory" id="inventoryContainer" style="display: none;">
                <div class="inventory-title">ğŸ“¦ ç‰©å“æ </div>
                <div class="inventory-items" id="inventoryItems"></div>
            </div>

            <!-- é€‰é¡¹ -->
            <div class="options-container" id="optionsContainer">
                <!-- é€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ç»“å±€é¡µé¢ -->
        <div id="endingSection" class="game-section">
            <div class="ending-screen">
                <div class="ending-title" id="endingTitle">æ¸¸æˆç»“æŸ</div>
                <div class="ending-content" id="endingContent">
                    æ•…äº‹åœ¨è¿™é‡Œç»“æŸ...
                </div>
                <button class="btn" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            currentSection: 'start',
            character: null,
            stats: {
                constitution: 0,
                strength: 0,
                agility: 0,
                wisdom: 0,
                willpower: 0
            },
            baseStats: {
                emperor: { health: 120, attack: 15, defense: 10, luck: 5 },
                young: { health: 90, attack: 12, defense: 8, luck: 20 },
                liu: { health: 130, attack: 18, defense: 12, luck: 5 }
            },
            health: 100,
            maxHealth: 100,
            hunger: 100,
            thirst: 100,
            day: 1,
            location: 'åºŸå¢Ÿ',
            inventory: {},
            combatLog: [],
            events: 0,
            enemyDefeated: 0,
            wrinkledKingHealth: 150,
            wrinkledKingMaxHealth: 150,
            inCombat: false,
            currentEnemy: null,
            story: []
        };

        const characterInfo = {
            emperor: {
                name: 'è¯¸å¤©æœªæ¥ä»™å¸',
                description: 'æ›¾ç»ä»™åº­æœ€æœ‰å¤©èµ‹çš„ä¿®å£«',
                bonus: { healthBonus: 0.15, attackBonus: 0.10 }
            },
            young: {
                name: 'æ²³åŒ—å°æ¨',
                description: 'çµæ•èªæ…§ï¼Œæœºæ™ºè¿‡äºº',
                bonus: { agilityBonus: 0.20, luckBonus: 0.25 }
            },
            liu: {
                name: 'åˆ˜ä¸–é¹',
                description: 'é“è¡€æˆ˜å£«ï¼Œæ„å¿—é¡½å¼º',
                bonus: { strengthBonus: 0.20, willpowerBonus: 0.15 }
            }
        };

        // UI æ›´æ–°å‡½æ•°
        function showSection(sectionId) {
            document.querySelectorAll('.game-section').forEach(el => el.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            gameState.currentSection = sectionId;
        }

        // è§’è‰²é€‰æ‹©
        function selectCharacter(character) {
            gameState.character = character;
            showSection('allocateSection');
            updatePointsDisplay();
        }

        // å±æ€§ç‚¹ç®¡ç†
        function increaseStat(stat) {
            if (parseInt(document.getElementById('remainingPoints').textContent) > 0) {
                gameState.stats[stat]++;
                updatePointsDisplay();
            }
        }

        function decreaseStat(stat) {
            if (gameState.stats[stat] > 0) {
                gameState.stats[stat]--;
                updatePointsDisplay();
            }
        }

        function updatePointsDisplay() {
            const total = Object.values(gameState.stats).reduce((a, b) => a + b, 0);
            const remaining = 10 - total;
            document.getElementById('remainingPoints').textContent = remaining;

            for (let stat in gameState.stats) {
                document.getElementById(`${stat}-value`).textContent = gameState.stats[stat];
            }
        }

        function goBack() {
            gameState.stats = {
                constitution: 0,
                strength: 0,
                agility: 0,
                wisdom: 0,
                willpower: 0
            };
            showSection('startSection');
        }

        // æ¸¸æˆåˆå§‹åŒ–
        function startGame() {
            // è®¡ç®—æœ€ç»ˆå±æ€§
            const base = gameState.baseStats[gameState.character];
            const charBonus = characterInfo[gameState.character].bonus;

            gameState.maxHealth = base.health + (gameState.stats.constitution * 8);
            if (charBonus.healthBonus) {
                gameState.maxHealth = Math.floor(gameState.maxHealth * (1 + charBonus.healthBonus));
            }
            gameState.health = gameState.maxHealth;

            gameState.attack = base.attack + (gameState.stats.strength * 2);
            if (charBonus.strengthBonus) {
                gameState.attack = Math.floor(gameState.attack * (1 + charBonus.strengthBonus));
            }

            gameState.defense = base.defense + (gameState.stats.agility * 1.5);
            if (charBonus.agilityBonus) {
                gameState.defense = Math.floor(gameState.defense * (1 + charBonus.agilityBonus));
            }

            gameState.healing = base.attack + (gameState.stats.wisdom * 1.5);
            gameState.resistance = gameState.stats.willpower * 2;
            gameState.luck = base.luck + gameState.stats.agility;
            if (charBonus.luckBonus) {
                gameState.luck = Math.floor(gameState.luck * (1 + charBonus.luckBonus));
            }

            gameState.inventory = {
                'æœ¨æ': 5,
                'æ¸…æ°´': 3,
                'å¹²ç²®': 2,
                'è‰è¯': 1
            };

            showSection('gameSection');
            initializeGame();
        }

        function initializeGame() {
            gameState.day = 1;
            gameState.location = 'ä»™å®¶å†›åºŸå¢Ÿ';
            gameState.story = [];
            updateUI();
            showStory1();
        }

        // æ•…äº‹äº‹ä»¶
        function showStory1() {
            const storyText = `
            <strong>ç¬¬ä¸€å¤© - è‹é†’</strong><br><br>
            ä½ ä»åºŸå¢Ÿä¸­é†’æ¥ï¼Œæ•´ä¸ªä»™åº­è¢«æ‘§æ¯äº†ã€‚çƒŸç«å¼¥æ¼«ï¼Œæ»¡ç›®ç–®ç—ã€‚<br>
            é‚£å¤´å‡¶æ®‹çš„çš±çš®å¤§ç‹å’Œå®ƒçš„å¦–é­”å†›å›¢å·²ç»ç¦»å¼€äº†ï¼Œä½†ç•™ä¸‹äº†ç»æœ›å’Œæ­»äº¡ã€‚<br><br>
            ä½ å’¬ç´§ç‰™å…³ï¼Œæ¡ç´§æ‹³å¤´ã€‚æ— è®ºå¦‚ä½•ï¼Œä½ å¿…é¡»æ´»ä¸‹å»ï¼Œå¹¶æ‰¾åˆ°çš±çš®å¤§ç‹å¤ä»‡ï¼<br>
            å‘¨å›´ä¸€ç‰‡ç‹¼è—‰ï¼Œä½ éœ€è¦æ”¶é›†ç”Ÿå­˜æ‰€éœ€çš„ç‰©èµ„...
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸ” æ”¶é›†ç‰©èµ„', () => {
                gameState.day++;
                gameState.hunger -= 10;
                gameState.thirst -= 10;
                const found = Math.floor(Math.random() * 3);
                if (found === 0) {
                    gameState.inventory['æœ¨æ'] = (gameState.inventory['æœ¨æ'] || 0) + 3;
                    showOption2A();
                } else if (found === 1) {
                    gameState.inventory['æ¸…æ°´'] = (gameState.inventory['æ¸…æ°´'] || 0) + 2;
                    showOption2B();
                } else {
                    gameState.inventory['å¹²ç²®'] = (gameState.inventory['å¹²ç²®'] || 0) + 2;
                    showOption2C();
                }
            });
            addOption('ğŸƒ å‰å¾€å—è¾¹å±±æ—', () => {
                gameState.day++;
                gameState.location = 'å—è¾¹å±±æ—';
                showStory3();
            });
            addOption('âš°ï¸ æ¢ç´¢é—è¿¹', () => {
                gameState.day++;
                showStory4();
            });
        }

        function showOption2A() {
            const storyText = `
            <strong>ç¬¬äºŒå¤© - æ”¶è·</strong><br><br>
            ä½ åœ¨åºŸå¢Ÿä¸­ä»”ç»†æœå¯»ï¼Œæ‰¾åˆ°äº†ä¸€äº›ä¿å­˜å®Œå¥½çš„æœ¨æã€‚<br>
            è¿™äº›æœ¨ææ˜¯åˆ¶é€ å·¥å…·å’Œæ­¦å™¨çš„å¥½ææ–™ã€‚
            `;
            displayStory(storyText);

            clearOptions();
            addOption('âš’ï¸ åˆ¶é€ æœ¨æ£', () => {
                if (gameState.inventory['æœ¨æ'] >= 2) {
                    gameState.inventory['æœ¨æ'] -= 2;
                    gameState.inventory['æœ¨æ£'] = (gameState.inventory['æœ¨æ£'] || 0) + 1;
                    updateUI();
                    showMessage('åˆ¶é€ æˆåŠŸï¼ä½ ç°åœ¨æ‹¥æœ‰ä¸€æ ¹åšå›ºçš„æœ¨æ£ã€‚', 'buff');
                    setTimeout(showExplore1, 1500);
                } else {
                    showMessage('æœ¨æä¸è¶³ï¼', 'damage');
                }
            });
            addOption('ğŸ“ ç»§ç»­å‰è¿›', () => showExplore1());
        }

        function showOption2B() {
            const storyText = `
            <strong>ç¬¬äºŒå¤© - ç”˜éœ–</strong><br><br>
            ä½ æ‰¾åˆ°äº†ä¸€ä¸ªæ¸…æ°´æ³‰çœ¼ï¼Œè¿™æ˜¯æ²™æ¼ ä¸­çš„ç»¿æ´²ã€‚<br>
            ä½ æ”¶é›†äº†æ¸…æ°´ï¼Œè¿™å°†å¤§å¤§ç¼“è§£ä½ çš„æ¸´æœ›ã€‚
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸ’§ å–æ°´æ¢å¤', () => {
                gameState.thirst = 100;
                gameState.inventory['æ¸…æ°´']--;
                updateUI();
                showMessage('ä½ æ„Ÿåˆ°æ¸…çˆ½æ— æ¯”ï¼', 'heal');
                setTimeout(showExplore1, 1500);
            });
            addOption('ğŸ“ ç»§ç»­å‰è¿›', () => showExplore1());
        }

        function showOption2C() {
            const storyText = `
            <strong>ç¬¬äºŒå¤© - å¹²ç²®</strong><br><br>
            ä½ åœ¨åºŸå¢Ÿé™„è¿‘æ‰¾åˆ°äº†ä¸€äº›ä¿å­˜å®Œå¥½çš„å¹²ç²®ã€‚<br>
            è™½ç„¶å‘³é“ä¸€èˆ¬ï¼Œä½†èƒ½è®©ä½ æ´»ä¸‹å»ã€‚
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸ– è¿›é£Ÿè¡¥å……ä½“åŠ›', () => {
                gameState.hunger = 100;
                gameState.inventory['å¹²ç²®']--;
                updateUI();
                showMessage('ä½ è¡¥å……äº†èƒ½é‡ï¼', 'heal');
                setTimeout(showExplore1, 1500);
            });
            addOption('ğŸ“ ç»§ç»­å‰è¿›', () => showExplore1());
        }

        function showStory3() {
            const storyText = `
            <strong>ç¬¬ä¸‰å¤© - å±±æ—æ¢é™©</strong><br><br>
            å—è¾¹å±±æ—è¦†ç›–äº†æ•´ä¸ªåœ°åŒºã€‚ä½ è¸å…¥è¿™ç‰‡å¹½æ·±çš„æ£®æ—ï¼Œ<br>
            é˜³å…‰é€è¿‡æ ‘å¶æ´’è½ä¸‹æ¥ï¼Œå½¢æˆæ–‘é©³çš„å…‰å½±ã€‚<br>
            è¿™é‡Œç”Ÿå­˜ç€å„ç§é‡ç”ŸåŠ¨ç‰©ï¼Œä¹Ÿå¯èƒ½éšè—ç€å±é™©...
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸº é­é‡é‡å…½', () => {
                gameState.inCombat = true;
                gameState.currentEnemy = {
                    name: 'å‡¶æ¶é‡ç‹¼',
                    health: 30,
                    maxHealth: 30,
                    attack: 8,
                    defense: 3,
                    experience: 50,
                    loot: { 'ç‹¼çš®': 1, 'ç‹¼ç‰™': 1 }
                };
                startCombat();
            });
            addOption('ğŸŒ² å®‰å…¨åœ°é‡‡é›†', () => {
                gameState.inventory['è‰è¯'] = (gameState.inventory['è‰è¯'] || 0) + 3;
                showStory5A();
            });
            addOption('ğŸ”¦ æ¢ç´¢å±±æ´', () => {
                gameState.day++;
                showCaveeExplore();
            });
        }

        function showStory5A() {
            const storyText = `
            <strong>ç¬¬å››å¤© - è¯è‰æ”¶è·</strong><br><br>
            å±±æ—ä¸­ç”Ÿé•¿ç€è®¸å¤šçè´µçš„è¯è‰ã€‚ä½ å°å¿ƒåœ°é‡‡é›†ï¼Œ<br>
            è¿™äº›è‰è¯å¯ä»¥ç”¨æ¥åˆ¶é€ æ²»ç–—è¯æ°´ã€‚
            `;
            displayStory(storyText);

            clearOptions();
            addOption('âš—ï¸ åˆ¶é€ æ²»ç–—è¯æ°´', () => {
                if (gameState.inventory['è‰è¯'] >= 2) {
                    gameState.inventory['è‰è¯'] -= 2;
                    gameState.inventory['æ²»ç–—è¯æ°´'] = (gameState.inventory['æ²»ç–—è¯æ°´'] || 0) + 1;
                    updateUI();
                    showMessage('åˆ¶é€ æˆåŠŸï¼ä½ å¾—åˆ°äº†æ²»ç–—è¯æ°´ã€‚', 'buff');
                    setTimeout(() => showMiddleStory(), 1500);
                } else {
                    showMessage('è‰è¯ä¸è¶³ï¼', 'damage');
                }
            });
            addOption('ğŸ—ºï¸ ç»§ç»­æ¢ç´¢', () => showMiddleStory());
        }

        function showStory4() {
            const storyText = `
            <strong>ç¬¬ä¸‰å¤© - é—è¿¹æ¢ç´¢</strong><br><br>
            ä½ æ·±å…¥ä»™åº­çš„å†…éƒ¨é—è¿¹ï¼Œå¯»æ‰¾ä»»ä½•æœ‰ä»·å€¼çš„ä¸œè¥¿ã€‚<br>
            çªç„¶ï¼Œä¸€ä¸ªåŠå´©å¡Œçš„çŸ³å±‹å‡ºç°åœ¨çœ¼å‰ã€‚
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸ  è¿›å…¥çŸ³å±‹', () => {
                if (Math.random() > 0.5) {
                    gameState.inventory['å¤è€æ‰‹å·'] = (gameState.inventory['å¤è€æ‰‹å·'] || 0) + 1;
                    showStory4A();
                } else {
                    showStory4B();
                }
            });
            addOption('ğŸš¶ ç»•è¿‡é—è¿¹', () => showStory3());
        }

        function showStory4A() {
            const storyText = `
            <strong>å¹¸è¿å‘ç°</strong><br><br>
            åœ¨ä¸€ä¸ªç ´æŸçš„æœ¨ç®±é‡Œï¼Œä½ æ‰¾åˆ°äº†ä¸€å·å¤è€çš„æ‰‹å·ã€‚<br>
            è¿™å¯èƒ½æ˜¯ä¸€ä»½æ­¦åŠŸç§˜ç±æˆ–è€…é‡è¦ä¿¡æ¯...
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸ“– é˜…è¯»æ‰‹å·', () => {
                showMessage('ä½ è·å¾—äº†å…³é”®ä¿¡æ¯ï¼šçš±çš®å¤§ç‹ä½åœ¨åŒ—æ–¹çš„å¦–é­”å ¡å’ï¼', 'buff');
                setTimeout(showMiddleStory, 1500);
            });
        }

        function showStory4B() {
            const storyText = `
            <strong>å±é™©é­é‡</strong><br><br>
            çŸ³å±‹å†…çªç„¶å†²å‡ºä¸€åªå—ä¼¤çš„å¦–æ€ªï¼<br>
            è¿™æ˜¯ä¸€åªè¢«é—å¼ƒçš„å°å¦–ï¼Œä½†å®ƒä»ç„¶å…·æœ‰å±é™©æ€§ã€‚
            `;
            displayStory(storyText);

            clearOptions();
            addOption('âš”ï¸ æˆ˜æ–—', () => {
                gameState.inCombat = true;
                gameState.currentEnemy = {
                    name: 'æ®‹åºŸå¦–æ€ª',
                    health: 25,
                    maxHealth: 25,
                    attack: 6,
                    defense: 2,
                    experience: 30,
                    loot: { 'å¦–æ™¶': 1 }
                };
                startCombat();
            });
            addOption('ğŸƒ é€ƒç¦»', () => {
                gameState.hunger -= 5;
                gameState.thirst -= 5;
                showMiddleStory();
            });
        }

        function showCaveeExplore() {
            const storyText = `
            <strong>ç¬¬å››å¤© - å±±æ´ç§˜å¯†</strong><br><br>
            å±±æ´å†…é»‘æš—æ·±é‚ƒï¼Œä½ ç‚¹ç‡ƒäº†ä¸€æ ¹ç«æŠŠã€‚<br>
            è¶Šå¾€æ·±å¤„èµ°ï¼Œä½ æ„Ÿè§‰åˆ°ä¸€è‚¡å¥‡å¼‚çš„èƒ½é‡...
            `;
            displayStory(storyText);

            clearOptions();
            if (Math.random() > 0.4) {
                addOption('ğŸ’ å‘ç°å®è—', () => {
                    gameState.inventory['çµçŸ³'] = (gameState.inventory['çµçŸ³'] || 0) + 2;
                    showMessage('ä½ å‘ç°äº†é—ªé—ªå‘å…‰çš„çµçŸ³ï¼', 'buff');
                    setTimeout(showMiddleStory, 1500);
                });
            }
            addOption('ğŸ‘¹ é­é‡æ€ªç‰©', () => {
                gameState.inCombat = true;
                gameState.currentEnemy = {
                    name: 'æ´ç©´æ€ªç‰©',
                    health: 40,
                    maxHealth: 40,
                    attack: 10,
                    defense: 4,
                    experience: 80,
                    loot: { 'æ€ªç‰©æ ¸å¿ƒ': 1, 'é‡‘å¸': 20 }
                };
                startCombat();
            });
            addOption('ğŸš¶ é€€å‡ºå±±æ´', () => showMiddleStory());
        }

        function showMiddleStory() {
            gameState.day = 5;
            const storyText = `
            <strong>ç¬¬äº”å¤© - é»‘æš—é˜´äº‘ç¬¼ç½©</strong><br><br>
            å‡ å¤©çš„æ¢ç´¢è®©ä½ æ”¶é›†åˆ°äº†ä¸å°‘ç‰©èµ„ï¼Œä½ ä¹Ÿåœ¨é€æ¸äº†è§£è¿™ä¸ªä¸–ç•Œçš„å±é™©ã€‚<br>
            ä»å„ç§è¿¹è±¡æ¥çœ‹ï¼Œçš±çš®å¤§ç‹çš„åŠ¿åŠ›æ­£åœ¨æ‰©å¼ ã€‚<br>
            ä½ çœ‹åˆ°äº†å¤©ç©ºä¸­çš„é»‘æš—äº‘å±‚ï¼Œä¼¼ä¹é¢„ç¤ºç€ä¸€åœºå¤§é£æš´å³å°†åˆ°æ¥ã€‚<br><br>
            <strong style="color: #ffd54f;">ä½ å¿…é¡»æ‰¾åˆ°æ›´å¤šçš„ç›Ÿå‹ï¼Œæˆ–è€…æ›´å¼ºçš„åŠ›é‡æ¥å¯¹æŠ—çš±çš®å¤§ç‹...</strong>
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸ° å‰å¾€ä¸œæ–¹å¤åŸ', () => {
                gameState.day++;
                gameState.location = 'ä¸œæ–¹å¤åŸ';
                showEastCityStory();
            });
            addOption('â›º å»ºç«‹è¥åœ°ä¼‘æ•´', () => {
                gameState.day += 2;
                gameState.hunger -= 20;
                gameState.thirst -= 20;
                gameState.health = gameState.maxHealth;
                updateUI();
                showStory6();
            });
            addOption('ğŸ”® å‘åŒ—å‰è¿›', () => {
                gameState.day++;
                gameState.location = 'é»‘æš—ä¹‹åœ°';
                showNorthStory();
            });
        }

        function showEastCityStory() {
            const storyText = `
            <strong>ç¬¬å…­å¤© - ä¸œæ–¹å¤åŸ</strong><br><br>
            ä½ æ¥åˆ°äº†ä¸€åº§å¤è€çš„åŸå¸‚åºŸå¢Ÿã€‚åŸå¢™é«˜è€¸ï¼Œå»ºç­‘å®ä¼Ÿã€‚<br>
            è¿™é‡Œæ›¾ç»æ˜¯ä¸€ä¸ªç¹åçš„æ–‡æ˜ä¸­å¿ƒï¼Œç°åœ¨å´æ»¡æ˜¯æ²§æ¡‘ã€‚<br>
            ä¸€ä¸ªèº«å½±å‡ºç°åœ¨åŸé—¨å¤„...
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸ¤ é è¿‘å¯¹æ–¹', () => {
                showDialog('ç¥ç§˜äºº', 'ä½ å¥½ï¼Œæ—…è€…ã€‚ä½ ä¹Ÿæ˜¯ä»çš±çš®å¤§ç‹çš„ç¾éš¾ä¸­é€ƒè„±çš„å—ï¼Ÿæˆ‘å«äº‘å¯’...');
                setTimeout(() => {
                    clearOptions();
                    addOption('ğŸ“– äº†è§£æ›´å¤šä¿¡æ¯', () => {
                        showDialog('äº‘å¯’', 'çš±çš®å¤§ç‹æ˜¯å¦–é­”ç•Œçš„è‡³å¼ºè€…ã€‚å®ƒç‡é¢†çš„å†›é˜Ÿå·²ç»å é¢†äº†å¤§åŠä¸ªä¸–ç•Œã€‚å¬è¯´å®ƒçš„è€å·¢åœ¨åŒ—æ–¹çš„æ°¸å¤œå ¡å’ã€‚åªæœ‰é›†åˆä¼—äººä¹‹åŠ›ï¼Œæ‰æœ‰å¯èƒ½æ‰“è´¥å®ƒã€‚');
                        setTimeout(() => {
                            clearOptions();
                            addOption('ğŸ¤ ç»“æˆåŒç›Ÿ', () => {
                                gameState.inventory['ç›Ÿå‹ï¼šäº‘å¯’'] = true;
                                showMessage('äº‘å¯’åŠ å…¥äº†ä½ çš„é˜Ÿä¼ï¼', 'buff');
                                setTimeout(showStory7, 1500);
                            });
                            addOption('âš”ï¸ æ‹’ç»å¹¶æˆ˜æ–—', () => {
                                gameState.inCombat = true;
                                gameState.currentEnemy = {
                                    name: 'äº‘å¯’',
                                    health: 60,
                                    maxHealth: 60,
                                    attack: 12,
                                    defense: 8,
                                    experience: 150,
                                    loot: {}
                                };
                                startCombat();
                            });
                        }, 500);
                    });
                    addOption('ğŸš¶ ç¦»å¼€', () => showMiddleStory());
                }, 500);
            });
            addOption('âš”ï¸ ç«‹å³æ”»å‡»', () => {
                gameState.inCombat = true;
                gameState.currentEnemy = {
                    name: 'åŸå¸‚å®ˆå«',
                    health: 50,
                    maxHealth: 50,
                    attack: 11,
                    defense: 7,
                    experience: 120,
                    loot: { 'å®ˆå«å‰‘': 1 }
                };
                startCombat();
            });
            addOption('ğŸƒ ç¦»å¼€å¤åŸ', () => showMiddleStory());
        }

        function showStory6() {
            const storyText = `
            <strong>ç¬¬å…«å¤© - è¥åœ°ä¿®æ•´</strong><br><br>
            ä½ æ‰¾åˆ°äº†ä¸€ä¸ªéšè”½çš„å±±è°·ï¼Œå»ºç«‹äº†ä¸€ä¸ªä¸´æ—¶è¥åœ°ã€‚<br>
            åœ¨è¿™é‡Œï¼Œä½ ä¼‘æ¯äº†æ•´ä¸ªç™½å¤©å’Œå¤œæ™šï¼Œæ¢å¤äº†ä½“åŠ›ã€‚<br>
            å½“ä½ å†æ¬¡å‡ºå‘æ—¶ï¼Œä½ æ„Ÿåˆ°å‰æ‰€æœªæœ‰çš„åŠ›é‡æ¶Œå…¥ä½“å†…...
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸ”¥ å‰å¾€åŒ—æ–¹è¦å¡', () => {
                gameState.day++;
                showNorthStory();
            });
        }

        function showNorthStory() {
            const storyText = `
            <strong>ç¬¬${gameState.day}å¤© - åŒ—æ–¹é»‘æš—ä¹‹åœ°</strong><br><br>
            ä½ å‘åŒ—æ–¹å‰è¿›ï¼Œå¤©ç©ºé€æ¸å˜å¾—é˜´æ²‰ã€‚<br>
            è¿œå¤„éšçº¦å¯è§ä¸€åº§å·¨å¤§çš„åŸå ¡ï¼Œå››å‘¨è¢«é»‘æš—çš„èƒ½é‡ç¬¼ç½©ã€‚<br>
            è¿™å°±æ˜¯çš±çš®å¤§ç‹çš„å·¢ç©´â€”â€”æ°¸å¤œå ¡å’ï¼<br><br>
            çªç„¶ï¼Œå¤§åœ°éœ‡åŠ¨ï¼Œä¸€ç¾¤å¦–é­”å£«å…µå‡ºç°åœ¨ä½ é¢å‰ï¼
            `;
            displayStory(storyText);

            clearOptions();
            addOption('âš”ï¸ è¿æˆ˜å¦–é­”å£«å…µ', () => {
                gameState.inCombat = true;
                gameState.currentEnemy = {
                    name: 'å¦–é­”å£«å…µå°é˜Ÿ',
                    health: 80,
                    maxHealth: 80,
                    attack: 13,
                    defense: 6,
                    experience: 200,
                    loot: { 'å¦–é­”é•¿å‰‘': 1, 'é‡‘å¸': 50 }
                };
                startCombat();
            });
            addOption('ğŸ›¡ï¸ é˜²å®ˆèº²é¿', () => {
                gameState.hunger -= 15;
                gameState.health -= 20;
                updateUI();
                if (gameState.health <= 0) {
                    showEnding('death');
                } else {
                    showMessage('ä½ å‹‰å¼ºèº²è¿‡äº†ä¸€æ³¢å¦–é­”çš„è¿›æ”»ï¼', 'buff');
                    setTimeout(() => {
                        clearOptions();
                        addOption('ğŸšª å†²è¿›åŸå ¡å¤§é—¨', showFinalBattle);
                        addOption('ğŸƒ æ’¤é€€', showMiddleStory);
                    }, 1000);
                }
            });
        }

        function showStory7() {
            const storyText = `
            <strong>ç¬¬ä¸ƒå¤© - è”ç›Ÿæ—¶åˆ»</strong><br><br>
            ä¸äº‘å¯’çš„è”åˆä½¿ä½ çš„åŠ›é‡å¤§å¹…å¢å¼ºã€‚<br>
            ä½ ä»¬å¼€å§‹åˆ¶å®šè®¡åˆ’ï¼Œå‡†å¤‡å¯¹çš±çš®å¤§ç‹è¿›è¡Œæœ€åçš„æ”»å‡»ã€‚<br>
            äº‘å¯’å‘Šè¯‰ä½ ä¸€ä¸ªå…³é”®ä¿¡æ¯ï¼šçš±çš®å¤§ç‹çš„çœŸèº«å°±åœ¨æ°¸å¤œå ¡å’çš„æœ€æ·±å¤„ã€‚
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸ”¥ å‡†å¤‡è¿›æ”»', () => {
                gameState.day++;
                showFinalPreparation();
            });
        }

        function showFinalPreparation() {
            const storyText = `
            <strong>ç¬¬${gameState.day}å¤© - æœ€ç»ˆå‡†å¤‡</strong><br><br>
            ä½ æ•´ç†å¥½æ‰€æœ‰çš„è£…å¤‡ï¼Œæ£€æŸ¥ç‰©å“æ ä¸­çš„æ¯ä¸€ä»¶ç‰©å“ã€‚<br>
            å¿ƒä¸­é—ªè¿‡æ€æ­»çš±çš®å¤§ç‹ï¼Œä¸ºä»™å®¶å†›å¤ä»‡çš„å†³å¿ƒã€‚<br><br>
            <strong style="color: #ffd54f;">æœ€ç»ˆä¹‹æˆ˜å³å°†å¼€å§‹...</strong>
            `;
            displayStory(storyText);

            clearOptions();
            addOption('ğŸ’ª å‰å¾€æ°¸å¤œå ¡å’', () => {
                gameState.day++;
                gameState.location = 'æ°¸å¤œå ¡å’';
                showFinalBattle();
            });
            addOption('âš—ï¸ å…ˆåˆ¶é€ å¼ºåŠ›æ­¦å™¨', () => {
                if (gameState.inventory['æœ¨æ'] >= 5 && gameState.inventory['çµçŸ³']) {
                    gameState.inventory['æœ¨æ'] -= 5;
                    gameState.inventory['çµçŸ³']--;
                    gameState.inventory['çµèƒ½é•¿å‰‘'] = 1;
                    gameState.attack += 15;
                    updateUI();
                    showMessage('ä½ åˆ¶é€ äº†çµèƒ½é•¿å‰‘ï¼æ”»å‡»åŠ›å¤§å¹…æå‡ï¼', 'buff');
                    setTimeout(() => {
                        clearOptions();
                        addOption('âš”ï¸ ç°åœ¨å‰å¾€å†³æˆ˜', showFinalBattle);
                    }, 1500);
                } else {
                    showMessage('ææ–™ä¸è¶³ï¼', 'damage');
                }
            });
        }

        function showFinalBattle() {
            const storyText = `
            <strong>ç¬¬${gameState.day}å¤© - æ°¸å¤œå ¡å’ æœ€æ·±å¤„</strong><br><br>
            ä½ è¸å…¥äº†çš±çš®å¤§ç‹çš„å®«æ®¿ï¼Œé˜´æ£®çš„å…‰çº¿ç…§äº®äº†å››å‘¨ã€‚<br>
            æœ€ä¸­å¤®çš„ç‹åº§ä¸Šï¼Œåç€é‚£ä¸ªä»¤äººææƒ§çš„èº«å½±â€”â€”çš±çš®å¤§ç‹ï¼<br>
            å®ƒçš„èº«èº¯åºå¤§æ— æ¯”ï¼Œå……æ»¡äº†é‚ªæ¶çš„åŠ›é‡ã€‚<br><br>
            çš±çš®å¤§ç‹å‘å‡ºäº†éœ‡å¤©çš„æ€’å¼ï¼š"åˆæœ‰ä¸€ä¸ªæ¸ºå°çš„å‡¡äººæ•¢æ¥æŒ‘æˆ˜æˆ‘ï¼Ÿ"
            `;
            displayStory(storyText);

            clearOptions();
            addOption('âš”ï¸ å¼€å§‹å†³æˆ˜', () => {
                gameState.inCombat = true;
                gameState.currentEnemy = {
                    name: 'çš±çš®å¤§ç‹',
                    health: 200,
                    maxHealth: 200,
                    attack: 20,
                    defense: 10,
                    experience: 1000,
                    loot: { 'çš±çš®å¤§ç‹çš„å† å†•': 1, 'å¦–é­”ä¹‹å¿ƒ': 1 }
                };
                startCombat();
            });
        }

        // æˆ˜æ–—ç³»ç»Ÿ
        function startCombat() {
            gameState.combatLog = [];
            document.getElementById('combatLog').style.display = 'block';
            document.getElementById('combatLogContent').innerHTML = '';

            const storyText = `
            <strong>âš”ï¸ æˆ˜æ–—å¼€å§‹ï¼</strong><br><br>
            æ•Œäººï¼š${gameState.currentEnemy.name}<br>
            ç”Ÿå‘½å€¼ï¼š${gameState.currentEnemy.health}/${gameState.currentEnemy.maxHealth}
            `;
            displayStory(storyText);

            showCombatOptions();
        }

        function showCombatOptions() {
            clearOptions();
            addOption('ğŸ—¡ï¸ æ™®é€šæ”»å‡»', combatAttack);
            addOption('ğŸ’ª å¼ºåŠ›æ”»å‡»', combatPowerAttack);
            addOption('ğŸ›¡ï¸ é˜²å®ˆ', combatDefend);
            if (gameState.inventory['æ²»ç–—è¯æ°´'] > 0) {
                addOption('âš—ï¸ ä½¿ç”¨æ²»ç–—è¯æ°´', () => {
                    gameState.inventory['æ²»ç–—è¯æ°´']--;
                    gameState.health = Math.min(gameState.health + 50, gameState.maxHealth);
                    addCombatLog(`ä½ ä½¿ç”¨äº†æ²»ç–—è¯æ°´ï¼Œæ¢å¤äº†50ç‚¹ç”Ÿå‘½å€¼ï¼`, 'heal');
                    updateUI();
                    enemyTurn();
                });
            }
            if (gameState.location === 'æ°¸å¤œå ¡å’') {
                addOption('ğŸƒ é€ƒç¦»', () => {
                    if (Math.random() > 0.7) {
                        gameState.inCombat = false;
                        addCombatLog('ä½ æˆåŠŸé€ƒç¦»äº†æˆ˜åœºï¼', 'buff');
                        showMiddleStory();
                    } else {
                        addCombatLog('é€ƒç¦»å¤±è´¥ï¼å—åˆ°äº†æ•Œäººçš„æ”»å‡»ï¼', 'damage');
                        enemyTurn();
                    }
                });
            }
        }

        function combatAttack() {
            const baseDamage = gameState.attack;
            const randomFactor = Math.floor(Math.random() * 10) - 5;
            const damage = Math.max(1, baseDamage + randomFactor - gameState.currentEnemy.defense / 2);

            gameState.currentEnemy.health -= damage;
            addCombatLog(`ä½ å¯¹${gameState.currentEnemy.name}é€ æˆäº†${damage}ç‚¹ä¼¤å®³ï¼`, 'damage');

            if (gameState.currentEnemy.health <= 0) {
                combatVictory();
            } else {
                updateUI();
                enemyTurn();
            }
        }

        function combatPowerAttack() {
            gameState.hunger -= 5;
            gameState.thirst -= 5;
            const baseDamage = gameState.attack * 1.5;
            const randomFactor = Math.floor(Math.random() * 15) - 5;
            const damage = Math.max(1, baseDamage + randomFactor - gameState.currentEnemy.defense);

            gameState.currentEnemy.health -= damage;
            addCombatLog(`ä½ ä½¿ç”¨å¼ºåŠ›æ”»å‡»å¯¹${gameState.currentEnemy.name}é€ æˆäº†${damage}ç‚¹ä¼¤å®³ï¼`, 'damage');

            if (gameState.currentEnemy.health <= 0) {
                combatVictory();
            } else {
                updateUI();
                enemyTurn();
            }
        }

        function combatDefend() {
            gameState.defense += 5;
            const damage = Math.max(0, gameState.currentEnemy.attack - gameState.defense / 2 - 5);
            gameState.health -= damage;

            addCombatLog(`ä½ è¿›å…¥é˜²å®ˆçŠ¶æ€ï¼Œåªå—åˆ°äº†${damage}ç‚¹ä¼¤å®³ï¼`, 'buff');

            if (gameState.health <= 0) {
                combatDefeat();
            } else {
                gameState.defense -= 5;
                updateUI();
                showCombatOptions();
            }
        }

        function enemyTurn() {
            setTimeout(() => {
                const damage = Math.max(0, gameState.currentEnemy.attack - gameState.defense / 2 + Math.floor(Math.random() * 5) - 2);
                gameState.health -= damage;

                addCombatLog(`${gameState.currentEnemy.name}å¯¹ä½ é€ æˆäº†${damage}ç‚¹ä¼¤å®³ï¼`, 'damage');

                if (gameState.health <= 0) {
                    combatDefeat();
                } else {
                    updateUI();
                    showCombatOptions();
                }
            }, 800);
        }

        function combatVictory() {
            addCombatLog(`========== æˆ˜æ–—èƒœåˆ©ï¼==========`, 'buff');
            addCombatLog(`ä½ å‡»è´¥äº†${gameState.currentEnemy.name}ï¼`, 'buff');

            for (let item in gameState.currentEnemy.loot) {
                const count = gameState.currentEnemy.loot[item];
                gameState.inventory[item] = (gameState.inventory[item] || 0) + count;
                addCombatLog(`è·å¾—äº†${item}x${count}ï¼`, 'buff');
            }

            gameState.inCombat = false;

            // ç‰¹æ®Šå¤„ç†ï¼šå‡»è´¥çš±çš®å¤§ç‹
            if (gameState.currentEnemy.name === 'çš±çš®å¤§ç‹') {
                setTimeout(() => {
                    showEnding('true');
                }, 2000);
            } else {
                setTimeout(() => {
                    document.getElementById('combatLog').style.display = 'none';
                    updateUI();
                    showAfterCombat();
                }, 2000);
            }
        }

        function combatDefeat() {
            addCombatLog(`========== æˆ˜æ–—å¤±è´¥ï¼==========`, 'damage');
            addCombatLog(`ä½ è¢«${gameState.currentEnemy.name}å‡»è´¥äº†ï¼`, 'damage');

            gameState.inCombat = false;

            setTimeout(() => {
                showEnding('death');
            }, 2000);
        }

        function showAfterCombat() {
            const storyText = `
            <strong>æˆ˜æ–—å</strong><br><br>
            ç»å†äº†æ¿€çƒˆçš„æˆ˜æ–—ï¼Œä½ æ„Ÿåˆ°ç–²æƒ«å’Œä¼¤ç—›ã€‚<br>
            ä½†ä½ æ´»äº†ä¸‹æ¥ï¼ä½ å˜å¾—æ›´å¼ºäº†ã€‚<br><br>
            ä¸‹ä¸€æ­¥è¯¥å»å“ªé‡Œå‘¢ï¼Ÿ
            `;
            displayStory(storyText);

            clearOptions();
            addOption('â›º ä¼‘æ¯æ¢å¤', () => {
                gameState.day++;
                gameState.hunger = 100;
                gameState.thirst = 100;
                gameState.health = gameState.maxHealth;
                updateUI();
                showMessage('ä½ ä¼‘æ¯äº†ä¸€æ•´å¤©ï¼Œå®Œå…¨æ¢å¤äº†ï¼', 'heal');
                setTimeout(showFinalPreparation, 1500);
            });
            addOption('ğŸ”¥ ç»§ç»­å‰è¿›', () => {
                gameState.day++;
                showFinalPreparation();
            });
        }

        // ç»“å±€
        function showEnding(type) {
            showSection('endingSection');
            let title = '';
            let content = '';
            let contentClass = '';

            if (type === 'true') {
                title = 'çœŸç»“å±€ - å¤ä»‡å®Œæˆ';
                contentClass = 'good';
                content = `
                <p style="margin-bottom: 20px;">
                çš±çš®å¤§ç‹å‘å‡ºæœ€åçš„æƒ¨å«å£°ï¼Œåºå¤§çš„èº«èº¯è½°ç„¶å€’åœ°ã€‚<br>
                é‚ªæ¶çš„åŠ›é‡ä»å®ƒä½“å†…æ¶ˆæ•£ï¼Œæ°¸å¤œå ¡å’å¼€å§‹å´©å¡Œã€‚
                </p>
                <p style="margin-bottom: 20px;">
                ä½ ç«™åœ¨åºŸå¢Ÿä¸­ï¼Œç»ˆäºä¸ºä»™å®¶å†›çš„æ‰€æœ‰äººå¤äº†ä»‡ã€‚<br>
                è™½ç„¶å®¶å›­å·²ç»æ— æ³•é‡å»ºï¼Œä½†çš±çš®å¤§ç‹çš„å¨èƒå½»åº•æ¶ˆé™¤äº†ã€‚
                </p>
                <p style="margin-bottom: 20px;">
                ä½ çš„çœ¼ä¸­é—ªçƒç€æ³ªå…‰ã€‚åœ¨é£ä¸­ï¼Œä½ ä¼¼ä¹å¬åˆ°äº†æ‰€æœ‰å¤±å»çš„åŒä¼´åœ¨æ­Œå”±...
                </p>
                <p style="color: #ffd54f; font-size: 1.1em;">
                â­ æ­å–œï¼ä½ è¾¾æˆäº†çœŸç»“å±€ï¼â­
                </p>
                `;
            } else if (type === 'death') {
                title = 'æ­»äº¡ç»“å±€ - æ°¸çœ ';
                contentClass = 'bad';
                content = `
                <p style="margin-bottom: 20px;">
                ä½ çš„ç”Ÿå‘½åœ¨æˆ˜æ–—ä¸­é€æ¸æµé€...<br>
                æ„è¯†å˜å¾—æ¨¡ç³Šï¼Œçœ¼å‰çš„ä¸–ç•Œå¼€å§‹è¤ªè‰²ã€‚
                </p>
                <p style="margin-bottom: 20px;">
                ä½ æ²¡æœ‰èƒ½å¤Ÿå®Œæˆå¤ä»‡çš„èª“è¨€ã€‚<br>
                çš±çš®å¤§ç‹ä¾ç„¶æ´»åœ¨è¿™ä¸ªä¸–ç•Œä¸Šï¼Œç»§ç»­ä¸ºå®³...
                </p>
                <p style="margin-bottom: 20px;">
                ä½ çš„èº«ä½“æ°¸è¿œåœ°ç•™åœ¨äº†è¿™ç‰‡è’èŠœçš„åœŸåœ°ä¸Šã€‚
                </p>
                <p style="color: #f44336; font-size: 1.1em;">
                âŒ æ¸¸æˆç»“æŸ âŒ
                </p>
                `;
            }

            document.getElementById('endingTitle').textContent = title;
            document.getElementById('endingContent').innerHTML = content;
            document.getElementById('endingContent').className = contentClass;
        }

        // UI è¾…åŠ©å‡½æ•°
        function displayStory(text) {
            document.getElementById('storyText').innerHTML = text;
        }

        function showDialog(name, text) {
            const dialogHTML = `
            <div class="dialog-box">
                <div class="dialog-name">${name}ï¼š</div>
                <div class="dialog-text">${text}</div>
            </div>
            `;
            document.getElementById('storyText').innerHTML = dialogHTML;
        }

        function addCombatLog(text, type = 'normal') {
            const logItem = document.createElement('div');
            logItem.className = `combat-log-item ${type}`;
            logItem.textContent = text;
            document.getElementById('combatLogContent').appendChild(logItem);
            document.getElementById('combatLogContent').scrollTop = document.getElementById('combatLogContent').scrollHeight;
        }

        function clearOptions() {
            document.getElementById('optionsContainer').innerHTML = '';
        }

        function addOption(text, callback) {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = text;
            btn.onclick = callback;
            document.getElementById('optionsContainer').appendChild(btn);
        }

        function showMessage(text, type = 'normal') {
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); color: white; padding: 15px 25px; border-radius: 5px; border-left: 3px solid; z-index: 1000; font-weight: bold;';
            
            if (type === 'damage') {
                tempDiv.borderLeftColor = '#f44336';
                tempDiv.color = '#f44336';
            } else if (type === 'heal') {
                tempDiv.borderLeftColor = '#4caf50';
                tempDiv.color = '#4caf50';
            } else if (type === 'buff') {
                tempDiv.borderLeftColor = '#64b5f6';
                tempDiv.color = '#64b5f6';
            }

            tempDiv.textContent = text;
            document.body.appendChild(tempDiv);

            setTimeout(() => {
                tempDiv.remove();
            }, 3000);
        }

        function updateUI() {
            // æ›´æ–°ç”Ÿå‘½å€¼
            const healthPercent = (gameState.health / gameState.maxHealth) * 100;
            document.getElementById('health-display').textContent = `${gameState.health}/${gameState.maxHealth}`;
            document.getElementById('health-bar').style.width = healthPercent + '%';

            // æ›´æ–°é¥±é£Ÿåº¦
            const hungerPercent = (gameState.hunger / 100) * 100;
            document.getElementById('hunger-display').textContent = `${gameState.hunger}/100`;
            document.getElementById('hunger-bar').style.width = hungerPercent + '%';
            if (gameState.hunger < 30) {
                document.getElementById('hunger-fill').style.background = 'linear-gradient(90deg, #f44336, #ff9800)';
            }

            // æ›´æ–°æ¸´æœ›åº¦
            const thirstPercent = (gameState.thirst / 100) * 100;
            document.getElementById('thirst-display').textContent = `${gameState.thirst}/100`;
            document.getElementById('thirst-bar').style.width = thirstPercent + '%';
            if (gameState.thirst < 30) {
                document.getElementById('thirst-fill').style.background = 'linear-gradient(90deg, #f44336, #2196f3)';
            }

            // æ›´æ–°æ—¥æœŸå’Œä½ç½®
            document.getElementById('day-display').textContent = `ç¬¬ ${gameState.day} å¤©`;
            document.getElementById('location-display').textContent = gameState.location;

            // æ›´æ–°çŠ¶æ€
            let status = 'æ­£å¸¸';
            if (gameState.hunger < 20) status = '<span style="color: #f44336;">é¥¥é¥¿</span>';
            if (gameState.thirst < 20) status = '<span style="color: #f44336;">å¹²æ¸´</span>';
            if (gameState.health < gameState.maxHealth * 0.3) status = '<span style="color: #f44336;">é‡ä¼¤</span>';
            document.getElementById('status-display').innerHTML = status;

            // æ›´æ–°ç‰©å“æ 
            const inventoryContainer = document.getElementById('inventoryItems');
            inventoryContainer.innerHTML = '';
            for (let item in gameState.inventory) {
                const count = gameState.inventory[item];
                if (count > 0 && typeof count === 'number') {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    itemDiv.innerHTML = `<div class="item-name">${item}</div><div class="item-count">x${count}</div>`;
                    inventoryContainer.appendChild(itemDiv);
                }
            }

            if (Object.keys(gameState.inventory).length > 0) {
                document.getElementById('inventoryContainer').style.display = 'block';
            }

            // æ£€æŸ¥æ˜¯å¦é¥¿æ­»æˆ–æ¸´æ­»
            gameState.hunger = Math.max(0, gameState.hunger - 0.5);
            gameState.thirst = Math.max(0, gameState.thirst - 0.5);

            if (gameState.hunger <= 0) {
                showMessage('ä½ å› ä¸ºé¥¥è’è€Œæ­»äº¡ï¼', 'damage');
                setTimeout(() => showEnding('death'), 1500);
                return;
            }

            if (gameState.thirst <= 0) {
                showMessage('ä½ å› ä¸ºç¼ºæ°´è€Œæ­»äº¡ï¼', 'damage');
                setTimeout(() => showEnding('death'), 1500);
                return;
            }

            if (gameState.health <= 0) {
                showEnding('death');
                return;
            }
        }
    </script>
</body>
</html>
