<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»™å®¶å†›æ±‚ç”Ÿè®°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(30, 30, 60, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }

        h1 {
            text-align: center;
            color: #ffd54f;
            font-size: clamp(1.5em, 5vw, 2.5em);
            margin-bottom: 20px;
            text-shadow: 2px 2px 10px rgba(255, 213, 79, 0.5);
        }

        .game-screen {
            display: none;
        }

        .game-screen.active {
            display: block;
        }

        /* å¼€åœºå±å¹• */
        .story-intro {
            text-align: center;
            line-height: 1.8;
            margin-bottom: 30px;
            font-size: clamp(0.85em, 2vw, 1.1em);
        }

        /* è§’è‰²é€‰æ‹© */
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(clamp(250px, 90vw, 280px), 1fr));
            gap: clamp(10px, 3vw, 20px);
            margin: 30px 0;
        }

        .character-card {
            background: rgba(50, 50, 80, 0.8);
            padding: clamp(15px, 3vw, 20px);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            min-height: 250px;
            display: flex;
            flex-direction: column;
        }

        .character-card:hover {
            transform: translateY(-5px);
            border-color: #ffd54f;
            box-shadow: 0 5px 20px rgba(255, 213, 79, 0.3);
        }

        .character-card.selected {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.2);
        }

        .character-name {
            font-size: clamp(1em, 2.5vw, 1.3em);
            color: #ffd54f;
            margin-bottom: 10px;
        }

        .character-desc {
            font-size: clamp(0.8em, 1.5vw, 0.9em);
            color: #bbb;
            margin-bottom: 10px;
        }

        .character-stats {
            font-size: clamp(0.75em, 1.2vw, 0.85em);
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .character-ability {
            color: #4caf50;
            margin-top: auto;
            font-size: clamp(0.75em, 1.2vw, 0.85em);
            padding-top: 10px;
            border-top: 1px solid rgba(76, 175, 80, 0.3);
        }

        /* å±æ€§åŠ ç‚¹ */
        .attribute-panel {
            background: rgba(50, 50, 80, 0.6);
            padding: clamp(15px, 3vw, 20px);
            border-radius: 10px;
            margin: 20px 0;
        }

        .attribute-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: clamp(10px, 2vw, 15px) 0;
            padding: clamp(8px, 1vw, 10px);
            background: rgba(30, 30, 50, 0.5);
            border-radius: 5px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .attribute-controls {
            display: flex;
            align-items: center;
            gap: clamp(10px, 2vw, 15px);
        }

        .attr-btn {
            width: clamp(30px, 6vw, 35px);
            height: clamp(30px, 6vw, 35px);
            border: none;
            background: #64b5f6;
            color: white;
            font-size: clamp(0.9em, 2vw, 1.2em);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .attr-btn:hover {
            background: #42a5f5;
            transform: scale(1.1);
        }

        .attr-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: scale(1);
        }

        .attr-value {
            font-size: clamp(1em, 2vw, 1.2em);
            font-weight: bold;
            color: #ffd54f;
            min-width: 30px;
            text-align: center;
        }

        .points-remaining {
            text-align: center;
            font-size: clamp(1.1em, 2.5vw, 1.3em);
            color: #4caf50;
            margin: 20px 0;
        }

        /* å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(30, 30, 60, 0.95);
            padding: clamp(20px, 5vw, 30px);
            border-radius: 15px;
            text-align: center;
            max-width: min(90vw, 500px);
            border: 2px solid #ffd54f;
            box-shadow: 0 0 30px rgba(255, 213, 79, 0.5);
            margin: 20px;
        }

        .modal-title {
            font-size: clamp(1.3em, 3vw, 1.5em);
            color: #ffd54f;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .modal-text {
            font-size: clamp(0.9em, 2vw, 1.1em);
            color: #64b5f6;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: clamp(10px, 2vw, 15px);
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-btn {
            padding: clamp(10px, 2vw, 12px) clamp(20px, 5vw, 30px);
            border: none;
            border-radius: 8px;
            font-size: clamp(0.9em, 2vw, 1em);
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .modal-btn-accept {
            background: #4caf50;
            color: white;
        }

        .modal-btn-accept:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .modal-btn-reject {
            background: #f44336;
            color: white;
            position: relative;
        }

        /* æ¸¸æˆä¸»ç•Œé¢ */
        .game-header {
            display: grid;
            grid-template-columns: 1fr;
            gap: clamp(15px, 3vw, 20px);
            margin-bottom: 20px;
            padding: clamp(15px, 2vw, 20px);
            background: rgba(50, 50, 80, 0.6);
            border-radius: 8px;
        }

        @media (min-width: 768px) {
            .game-header {
                grid-template-columns: 1fr 1fr;
            }
        }

        .character-info {
            display: flex;
            align-items: center;
            gap: clamp(15px, 3vw, 20px);
            font-size: clamp(0.9em, 1.5vw, 1em);
        }

        .current-location {
            text-align: right;
            color: #ffd54f;
            font-weight: bold;
            font-size: clamp(0.9em, 1.5vw, 1em);
        }

        .progress-info {
            grid-column: 1 / -1;
            padding-top: 15px;
            border-top: 1px solid rgba(100, 181, 246, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            font-size: clamp(0.8em, 1.2vw, 0.9em);
        }

        .level-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: clamp(5px, 1vw, 8px) clamp(12px, 2vw, 15px);
            border-radius: 20px;
            font-weight: bold;
            font-size: clamp(0.85em, 1.5vw, 1em);
        }

        .exp-bar {
            flex: 1;
            min-width: 150px;
            height: clamp(18px, 3vw, 20px);
            background: rgba(30, 30, 50, 0.8);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(0.65em, 1vw, 0.8em);
            font-weight: bold;
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(clamp(120px, 80vw, 150px), 1fr));
            gap: clamp(10px, 2vw, 15px);
            margin-bottom: 25px;
        }

        .status-item {
            background: rgba(50, 50, 80, 0.8);
            padding: clamp(12px, 2vw, 15px);
            border-radius: 8px;
            text-align: center;
            font-size: clamp(0.8em, 1.5vw, 0.95em);
        }

        .status-label {
            font-size: clamp(0.75em, 1.2vw, 0.9em);
            color: #bbb;
            margin-bottom: 8px;
        }

        .status-value {
            font-size: clamp(1em, 2vw, 1.3em);
            font-weight: bold;
        }

        .hp { color: #f44336; }
        .hunger { color: #ff9800; }
        .thirst { color: #2196f3; }
        .attack { color: #e91e63; }
        .defense { color: #9c27b0; }

        /* åœ°ç‚¹å¯¼èˆª */
        .location-nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(clamp(140px, 80vw, 180px), 1fr));
            gap: clamp(8px, 1.5vw, 12px);
            margin-bottom: 25px;
            padding: clamp(12px, 2vw, 15px);
            background: rgba(50, 50, 80, 0.6);
            border-radius: 8px;
        }

        .location-btn {
            padding: clamp(10px, 2vw, 12px);
            background: rgba(100, 181, 246, 0.3);
            border: 2px solid #64b5f6;
            color: #64b5f6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: clamp(0.8em, 1.5vw, 0.95em);
            position: relative;
        }

        .location-btn:hover:not(.locked) {
            background: rgba(100, 181, 246, 0.6);
            transform: translateY(-2px);
        }

        .location-btn.active {
            background: #64b5f6;
            color: #1a1a2e;
        }

        .location-btn.locked {
            background: rgba(50, 50, 50, 0.5);
            border-color: #555;
            color: #777;
            cursor: not-allowed;
        }

        .location-btn.locked::after {
            content: 'ğŸ”’';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: clamp(0.8em, 1.2vw, 1em);
        }

        .unlock-hint {
            font-size: clamp(0.65em, 1vw, 0.75em);
            color: #ff9800;
            margin-top: 3px;
        }

        /* æ¸¸æˆå†…å®¹åŒº */
        .game-content {
            background: rgba(30, 30, 50, 0.7);
            padding: clamp(15px, 3vw, 25px);
            border-radius: 10px;
            margin-bottom: 25px;
            min-height: 250px;
            line-height: 1.8;
            max-height: 500px;
            overflow-y: auto;
            font-size: clamp(0.85em, 1.5vw, 1em);
        }

        /* æŒ‰é’®åŒº */
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(clamp(140px, 80vw, 200px), 1fr));
            gap: clamp(8px, 2vw, 15px);
            margin-top: 20px;
        }

        .btn {
            padding: clamp(12px, 2vw, 15px) clamp(15px, 3vw, 25px);
            font-size: clamp(0.85em, 1.5vw, 1.1em);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            white-space: nowrap;
        }

        .btn-primary {
            background: #4caf50;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #da190b;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #2196f3;
            color: white;
        }

        .btn-info:hover:not(:disabled) {
            background: #0b7dda;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            background: #e68900;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            opacity: 0.6;
        }

        /* èƒŒpack */
        .inventory {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(clamp(120px, 80vw, 150px), 1fr));
            gap: clamp(8px, 2vw, 10px);
            margin-top: 15px;
        }

        .item {
            background: rgba(50, 50, 80, 0.8);
            padding: clamp(10px, 2vw, 12px);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            font-size: clamp(0.8em, 1.2vw, 0.9em);
        }

        .item:hover {
            border-color: #64b5f6;
            transform: scale(1.05);
        }

        .item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .item-count {
            color: #ffd54f;
            font-size: clamp(0.75em, 1vw, 0.9em);
            margin-bottom: 8px;
        }

        .item-effect {
            color: #4caf50;
            font-size: clamp(0.7em, 1vw, 0.8em);
            border-top: 1px solid rgba(76, 175, 80, 0.3);
            padding-top: 5px;
            margin-top: 5px;
        }

        /* åˆæˆç•Œé¢ */
        .craft-recipes {
            display: grid;
            gap: clamp(12px, 2vw, 15px);
            margin-top: 20px;
        }

        .recipe {
            background: rgba(50, 50, 80, 0.6);
            padding: clamp(12px, 2vw, 15px);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            font-size: clamp(0.8em, 1.2vw, 0.95em);
        }

        .recipe-info {
            flex: 1;
            min-width: 200px;
        }

        .recipe-name {
            font-size: clamp(0.95em, 1.5vw, 1.1em);
            color: #ffd54f;
            margin-bottom: 5px;
        }

        .recipe-materials {
            font-size: clamp(0.8em, 1.2vw, 0.9em);
            color: #bbb;
        }

        /* æˆ˜æ–—ç•Œé¢ */
        .battle-scene {
            text-align: center;
            padding: clamp(15px, 3vw, 20px);
        }

        .enemy-info {
            background: rgba(100, 30, 30, 0.6);
            padding: clamp(15px, 3vw, 20px);
            border-radius: 10px;
            margin: clamp(15px, 3vw, 20px) 0;
        }

        .enemy-name {
            font-size: clamp(1.2em, 3vw, 1.5em);
            color: #f44336;
            margin-bottom: 10px;
        }

        .battle-log {
            background: rgba(30, 30, 50, 0.8);
            padding: clamp(12px, 2vw, 15px);
            border-radius: 8px;
            margin: clamp(15px, 3vw, 20px) 0;
            max-height: 250px;
            overflow-y: auto;
            text-align: left;
            font-size: clamp(0.8em, 1.2vw, 0.95em);
        }

        .battle-log p {
            margin: clamp(6px, 1vw, 8px) 0;
            padding: 5px;
            border-left: 3px solid #64b5f6;
            padding-left: 10px;
        }

        .damage {
            color: #f44336;
        }

        .heal {
            color: #4caf50;
        }

        .info {
            color: #64b5f6;
        }

        /* ç»“å±€ç”»é¢ */
        .ending {
            text-align: center;
            padding: clamp(20px, 5vw, 30px);
            line-height: 2;
            font-size: clamp(0.9em, 1.5vw, 1.1em);
        }

        .ending h2 {
            font-size: clamp(1.5em, 4vw, 2em);
            margin-bottom: 20px;
        }

        .victory {
            color: #4caf50;
        }

        .defeat {
            color: #f44336;
        }

        /* éŸ³ä¹æ§åˆ¶ */
        .music-control {
            position: fixed;
            top: clamp(10px, 2vw, 20px);
            right: clamp(10px, 2vw, 20px);
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }

        .music-btn {
            background: rgba(76, 175, 80, 0.8);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 50%;
            width: clamp(45px, 8vw, 50px);
            height: clamp(45px, 8vw, 50px);
            font-size: clamp(1.2em, 2vw, 1.5em);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-btn:hover {
            background: rgba(76, 175, 80, 1);
            transform: scale(1.1);
        }

        .music-btn.muted {
            background: rgba(244, 67, 54, 0.8);
        }

        .music-status {
            font-size: clamp(0.7em, 1vw, 0.75em);
            color: #4caf50;
            text-align: center;
            white-space: nowrap;
            padding: clamp(3px, 1vw, 5px) clamp(8px, 1.5vw, 10px);
            background: rgba(50, 50, 80, 0.8);
            border-radius: 5px;
            min-width: 50px;
        }

        /* âœ… è°ƒè¯•æŒ‰é’® - åˆ†ç¦»ä¸ºä¸¤ä¸ªæŒ‰é’® */
        .debug-control {
            position: fixed;
            bottom: clamp(10px, 2vw, 20px);
            right: clamp(10px, 2vw, 20px);
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .debug-btn {
            background: rgba(156, 39, 176, 0.8);
            color: white;
            border: none;
            padding: clamp(10px, 2vw, 12px) clamp(15px, 3vw, 20px);
            border-radius: 8px;
            font-size: clamp(0.75em, 1.2vw, 0.9em);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }

        .debug-btn:hover {
            background: rgba(156, 39, 176, 1);
            transform: scale(1.05);
        }

        .debug-btn-map {
            background: rgba(33, 150, 243, 0.8);
        }

        .debug-btn-map:hover {
            background: rgba(33, 150, 243, 1);
        }

        /* æç¤ºæ¡† */
        .hint-box {
            background: rgba(255, 152, 0, 0.1);
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: clamp(12px, 2vw, 15px);
            margin: clamp(10px, 2vw, 15px) 0;
            color: #ffb74d;
            font-size: clamp(0.85em, 1.5vw, 1em);
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 30, 50, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #64b5f6;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #42a5f5;
        }

        /* æ‰‹æœºç‰¹æ®Šé€‚é… */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
                border-radius: 10px;
            }

            .btn {
                padding: 12px 10px;
                font-size: 0.9em;
            }

            .character-grid {
                grid-template-columns: 1fr;
            }

            .location-nav {
                grid-template-columns: repeat(2, 1fr);
            }

            .status-bar {
                grid-template-columns: repeat(2, 1fr);
            }

            .actions {
                grid-template-columns: 1fr;
            }

            .debug-btn {
                min-width: 90px;
                font-size: 0.8em;
                padding: 8px 10px;
            }
        }

        /* å¹³æ¿é€‚é… */
        @media (min-width: 768px) and (max-width: 1024px) {
            .character-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .location-nav {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- éŸ³ä¹æ§åˆ¶ -->
    <div class="music-control">
        <button class="music-btn" id="music-btn" onclick="toggleMusic()">ğŸ”Š</button>
        <div class="music-status" id="music-status">éŸ³ä¹å¼€å¯</div>
    </div>

    <!-- âœ… è°ƒè¯•æŒ‰é’® - åˆ†ç¦»ä¸ºä¸¤ä¸ªæŒ‰é’® -->
    <div class="debug-control">
        <button class="debug-btn debug-btn-map" onclick="unlockAllMaps()">ğŸ—ºï¸ è§£é”åœ°å›¾</button>
        <button class="debug-btn" onclick="addAllResources()">ğŸ“¦ è·å¾—ç‰©èµ„</button>
    </div>

    <div class="container">
        <h1>âš”ï¸ ä»™å®¶å†›æ±‚ç”Ÿè®° âš”ï¸</h1>

        <!-- å¼€åœºç•Œé¢ -->
        <div id="intro-screen" class="game-screen active">
            <div class="story-intro">
                <p style="margin-bottom: 20px;">
                    æ›¾ç»ï¼Œä»™åº­çš„å®¶å›­ç¹è£æ˜Œç››ã€‚ä½†åœ¨ä¸€ä¸ªæœˆé»‘é£é«˜çš„å¤œæ™šï¼Œ<br>
                    çš±çš®å¤§ç‹ç‡é¢†å¦–é­”å¤§å†›æ‘§æ¯äº†ä»™å®¶å†›çš„ä¸€åˆ‡ã€‚<br>
                    <span style="color: #ffd54f;">æ— æ•°åŒä¼´ä¸§ç”Ÿï¼Œå®¶å›­è¢«å¤·ä¸ºå¹³åœ°...</span><br>
                    <br>
                    <span style="color: #f44336;">ä½ æ˜¯å”¯ä¸€çš„å¹¸å­˜è€…ã€‚</span><br>
                    <span style="color: #ffd54f;">å®¶å›­å·²æ¯ï¼Œå¤ä»‡ä¹‹å¿µç‡ƒçƒ§åœ¨å¿ƒé—´...</span>
                </p>
                <p style="color: #64b5f6; margin-bottom: 20px;">é€‰æ‹©ä½ çš„è§’è‰²ï¼Œè¸ä¸Šå¤ä»‡ä¹‹æ—…</p>
                <p style="color: #ff9800;">
                    ğŸ’¡ æç¤ºï¼šæ‰‹æœºç”¨æˆ·è¯·å…è®¸éŸ³é¢‘æ’­æ”¾æƒé™ï¼Œå¯åœ¨éŸ³ä¹æŒ‰é’®å¤„æ§åˆ¶éŸ³ä¹å¼€å…³
                </p>
            </div>

            <div class="character-grid" id="character-list">
                <!-- è§’è‰²å¡ç‰‡å°†ç”±JSç”Ÿæˆ -->
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="startAttributeAllocation()" id="select-char-btn" disabled>
                    ç¡®è®¤é€‰æ‹©
                </button>
            </div>
        </div>

        <!-- å±æ€§åŠ ç‚¹ç•Œé¢ -->
        <div id="attribute-screen" class="game-screen">
            <h2 style="text-align: center; color: #64b5f6; margin-bottom: 20px;">å±æ€§åŠ ç‚¹</h2>
            <div class="points-remaining">
                å‰©ä½™ç‚¹æ•°: <span id="points-remaining">10</span>
            </div>
            <div class="attribute-panel" id="attribute-panel">
                <!-- å±æ€§åŠ ç‚¹å°†ç”±JSç”Ÿæˆ -->
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="startGame()">
                    å¼€å§‹æ¸¸æˆ
                </button>
            </div>
        </div>

        <!-- ä¸»æ¸¸æˆç•Œé¢ -->
        <div id="game-screen" class="game-screen">
            <!-- æ¸¸æˆå¤´éƒ¨ -->
            <div class="game-header">
                <div class="character-info">
                    <div>
                        <div style="color: #bbb;">è§’è‰²</div>
                        <div style="color: #ffd54f; font-weight: bold;" id="character-name">è¯¸å¤©æœªæ¥ä»™å¸</div>
                    </div>
                </div>
                <div class="current-location">
                    <div style="color: #bbb;">å½“å‰ä½ç½®</div>
                    <div id="location-display">âœ¨ ä»™å®¶å†›é—è¿¹</div>
                </div>
                <!-- è¿›åº¦ä¿¡æ¯ -->
                <div class="progress-info">
                    <div class="level-badge" id="level-display">Lv.1</div>
                    <div class="exp-bar">
                        <div class="exp-fill" id="exp-fill" style="width: 0%">
                            <span id="exp-text">0/300</span>
                        </div>
                    </div>
                    <div style="color: #64b5f6;" id="unlock-progress">1/8 åœ°å›¾</div>
                </div>
            </div>

            <!-- çŠ¶æ€æ  -->
            <div class="status-bar" id="status-bar">
                <div class="status-item">
                    <div class="status-label">ç”Ÿå‘½å€¼</div>
                    <div class="status-value hp" id="hp-display">100/100</div>
                </div>
                <div class="status-item">
                    <div class="status-label">é¥±é£Ÿåº¦</div>
                    <div class="status-value hunger" id="hunger-display">100/100</div>
                </div>
                <div class="status-item">
                    <div class="status-label">é¥¥æ¸´åº¦</div>
                    <div class="status-value thirst" id="thirst-display">100/100</div>
                </div>
                <div class="status-item">
                    <div class="status-label">æ”»å‡»åŠ›</div>
                    <div class="status-value attack" id="attack-display">10</div>
                </div>
                <div class="status-item">
                    <div class="status-label">é˜²å¾¡åŠ›</div>
                    <div class="status-value defense" id="defense-display">5</div>
                </div>
            </div>

            <!-- åœ°ç‚¹å¯¼èˆª -->
            <div style="margin-bottom: 15px;">
                <div style="color: #bbb; margin-bottom: 8px;">ğŸ—ºï¸ åœ°å›¾å¯¼èˆª</div>
                <div class="location-nav" id="location-nav">
                    <!-- åœ°ç‚¹æŒ‰é’®ç”±JSç”Ÿæˆ -->
                </div>
            </div>

            <!-- æ¸¸æˆå†…å®¹ -->
            <div class="game-content" id="game-content">
                <p>ä½ é†’æ¥æ—¶ï¼Œå‘ç°è‡ªå·±èº«å¤„ä»™å®¶å†›é—è¿¹ä¸­ã€‚æ–­è£‚çš„å®«æ®¿ã€ç„¦é»‘çš„åœŸåœ°ã€å¼¥æ¼«çš„çµæ°”æ··ä¹±...</p>
                <p style="color: #ffd54f; margin-top: 15px;">ä½ éœ€è¦æ”¶é›†èµ„æºã€åˆ¶ä½œæ­¦å™¨ï¼Œé€æ­¥å˜å¼ºï¼Œæœ€ç»ˆæ‰¾åˆ°çš±çš®å¤§ç‹å¤ä»‡ï¼</p>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="actions" id="main-actions">
                <button class="btn btn-info" onclick="explore()">ğŸ” æ¢ç´¢</button>
                <button class="btn btn-warning" onclick="showInventory()">ğŸ’ èƒŒåŒ…</button>
                <button class="btn btn-info" onclick="showCraft()">ğŸ”¨ åˆæˆ</button>
                <button class="btn btn-primary" onclick="rest()">ğŸ˜´ ä¼‘æ¯</button>
            </div>
        </div>

        <!-- èƒŒåŒ…ç•Œé¢ -->
        <div id="inventory-screen" class="game-screen">
            <h2 style="color: #64b5f6; margin-bottom: 20px;">ğŸ“¦ èƒŒåŒ…</h2>
            <div class="inventory" id="inventory-list">
                <!-- ç‰©å“å°†ç”±JSç”Ÿæˆ -->
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-info" onclick="backToGame()">è¿”å›</button>
            </div>
        </div>

        <!-- åˆæˆç•Œé¢ -->
        <div id="craft-screen" class="game-screen">
            <h2 style="color: #64b5f6; margin-bottom: 20px;">ğŸ”¨ åˆæˆå°</h2>
            <div class="craft-recipes" id="craft-recipes">
                <!-- é…æ–¹å°†ç”±JSç”Ÿæˆ -->
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-info" onclick="backToGame()">è¿”å›</button>
            </div>
        </div>

        <!-- æˆ˜æ–—ç•Œé¢ -->
        <div id="battle-screen" class="game-screen">
            <div class="battle-scene">
                <div class="enemy-info">
                    <div class="enemy-name" id="enemy-name">æ•Œäºº</div>
                    <div class="status-value hp" id="enemy-hp">100/100</div>
                </div>
                <div class="battle-log" id="battle-log">
                    <!-- æˆ˜æ–—æ—¥å¿— -->
                </div>
                <div class="actions">
                    <button class="btn btn-danger" onclick="attack()" id="attack-btn">âš”ï¸ æ”»å‡»</button>
                    <button class="btn btn-primary" onclick="useHealItem()" id="heal-btn">ğŸ’Š æ²»ç–—</button>
                    <button class="btn btn-warning" onclick="flee()" id="flee-btn">ğŸƒ é€ƒè·‘</button>
                </div>
            </div>
        </div>

        <!-- ç»“å±€ç•Œé¢ -->
        <div id="ending-screen" class="game-screen">
            <div class="ending" id="ending-content">
                <!-- ç»“å±€å†…å®¹ç”±JSç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- é™ˆé›¨æ¬£å¼¹çª— -->
    <div id="chenyuxin-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ğŸ’• é™ˆé›¨æ¬£ ğŸ’•</div>
            <div class="modal-text">
                æˆ‘æ˜¯é™ˆé›¨æ¬£<br>
                æˆ‘å–œæ¬¢ä½ ğŸŒ¹
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-accept" onclick="acceptConfession()">æ¥å—</button>
                <button class="modal-btn modal-btn-reject" id="reject-btn" onclick="rejectConfession()">æ‹’ç»</button>
            </div>
        </div>
    </div>

    <!-- åœ°å›¾è§£é”å¼¹çª— -->
    <div id="unlock-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ğŸ‰ åœ°å›¾è§£é”</div>
            <div class="modal-text" id="unlock-text">
                <!-- è§£é”ä¿¡æ¯ç”±JSç”Ÿæˆ -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-accept" onclick="closeUnlockModal()">å¥½çš„</button>
            </div>
        </div>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="main-music" crossorigin="anonymous" preload="auto" loop>
        <source src="https://raw.githubusercontent.com/rruixi/xianadventure/refs/heads/main/main.mp3" type="audio/mpeg">
    </audio>
    <audio id="normal-music" crossorigin="anonymous" preload="auto" loop>
        <source src="https://raw.githubusercontent.com/rruixi/xianadventure/refs/heads/main/normal.mp3" type="audio/mpeg">
    </audio>
    <audio id="fight-music" crossorigin="anonymous" preload="auto" loop>
        <source src="https://raw.githubusercontent.com/rruixi/xianadventure/refs/heads/main/fight.mp3" type="audio/mpeg">
    </audio>
    <audio id="click-sound">
        <source src="data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQIAAAAAAA==" type="audio/wav">
    </audio>

    <script>
        // éŸ³ä¹ç³»ç»Ÿ
        let audioContext = null;
        let musicMuted = false;
        let currentMusic = 'main';
        let musicEnabled = true;
        let hasUserInteracted = false;

        function initAudioContext() {
            if (!audioContext) {
                try {
                    window.AudioContext = window.AudioContext || window.webkitAudioContext;
                    audioContext = new AudioContext();
                } catch(e) {
                    console.log('AudioContext not supported');
                }
            }
        }

        function attemptPlay(audioElement) {
            if (!musicEnabled) return;
            const playPromise = audioElement.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    updateMusicStatus('éŸ³ä¹è¢«é˜»æ­¢');
                });
            }
        }

        function activateAudioOnUserInteraction() {
            if (!hasUserInteracted) {
                hasUserInteracted = true;
                initAudioContext();
                const mainMusic = document.getElementById('main-music');
                const normalMusic = document.getElementById('normal-music');
                const fightMusic = document.getElementById('fight-music');
                [mainMusic, normalMusic, fightMusic].forEach(audio => {
                    audio.muted = false;
                    audio.volume = 0.5;
                    audio.loop = true;
                });
                playMusic(currentMusic);
            }
        }

        function toggleMusic() {
            const btn = document.getElementById('music-btn');
            const mainMusic = document.getElementById('main-music');
            const normalMusic = document.getElementById('normal-music');
            const fightMusic = document.getElementById('fight-music');
            musicMuted = !musicMuted;
            if (musicMuted) {
                mainMusic.pause();
                normalMusic.pause();
                fightMusic.pause();
                btn.textContent = 'ğŸ”‡';
                btn.classList.add('muted');
                updateMusicStatus('å…³é—­');
            } else {
                btn.classList.remove('muted');
                btn.textContent = 'ğŸ”Š';
                updateMusicStatus('å¼€å¯');
                playMusic(currentMusic);
            }
        }

        function updateMusicStatus(text) {
            document.getElementById('music-status').textContent = text;
        }

        function playMusic(type) {
            if (musicMuted) return;
            const mainMusic = document.getElementById('main-music');
            const normalMusic = document.getElementById('normal-music');
            const fightMusic = document.getElementById('fight-music');
            mainMusic.volume = 0.5;
            normalMusic.volume = 0.5;
            fightMusic.volume = 0.5;
            mainMusic.pause();
            normalMusic.pause();
            fightMusic.pause();
            currentMusic = type;
            switch(type) {
                case 'main':
                    mainMusic.currentTime = 0;
                    attemptPlay(mainMusic);
                    updateMusicStatus('ä¸»é¢˜');
                    break;
                case 'normal':
                    normalMusic.currentTime = 0;
                    attemptPlay(normalMusic);
                    updateMusicStatus('è¿›è¡Œ');
                    break;
                case 'fight':
                    fightMusic.currentTime = 0;
                    attemptPlay(fightMusic);
                    updateMusicStatus('æˆ˜æ–—');
                    break;
            }
        }

        function playClickSound() {
            if (musicMuted) return;
            const sound = document.getElementById('click-sound');
            sound.volume = 0.3;
            sound.currentTime = 0;
            const playPromise = sound.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {});
            }
        }

        // æ€ªç‰©è¡€é‡å’Œç»éªŒä¸Šè°ƒ
        const enemies = {
            'é‡ç‹¼': { hp: 80, attack: 8, defense: 3, reward: ['food', 'wood'], exp: 50 },
            'åºŸå¢Ÿå¹½çµ': { hp: 100, attack: 14, defense: 4, reward: ['herb', 'stone'], exp: 65 },
            'åŸè€æ€¨éª‘å£«': { hp: 140, attack: 12, defense: 8, reward: ['herb', 'potion'], exp: 100 },
            'æ¤°å¥¶é¦™é¦™çš„': { hp: 120, attack: 10, defense: 5, reward: ['meat', 'wood', 'herb'], exp: 85 },
            'å°çš±çš®': { hp: 110, attack: 11, defense: 6, reward: ['water', 'herb'], exp: 85 },
            'è›™è›™': { hp: 160, attack: 13, defense: 7, reward: ['water', 'stone', 'herb'], exp: 120 },
            'è·¯è¾¹ä¸€æ¡': { hp: 150, attack: 14, defense: 6, reward: ['meat', 'stone'], exp: 110 },
            'é…·é…·çš„ç‹—': { hp: 300, attack: 25, defense: 15, reward: ['meat', 'iron', 'soul_fragment'], exp: 350, boss: true },
            'å…¬å¸å‘˜å·¥': { hp: 120, attack: 12, defense: 6, reward: ['iron', 'stone', 'potion'], exp: 90 },
            'æ¶é­”': { hp: 200, attack: 18, defense: 10, reward: ['iron', 'soul_fragment'], exp: 180 },
            'åˆ˜ä¼Ÿ': { hp: 160, attack: 15, defense: 8, reward: ['stone', 'potion'], exp: 140 },
            'çŒ´å­': { hp: 150, attack: 16, defense: 6, reward: ['iron', 'herb'], exp: 130 },
            'ç±³é»˜': { hp: 240, attack: 20, defense: 12, reward: ['iron', 'soul_fragment', 'potion'], exp: 220 },
            'æ¡£å«å…µ': { hp: 180, attack: 17, defense: 10, reward: ['potion', 'herb', 'soul_fragment'], exp: 160 },
            'éº»è¾£ä»™äºº': { hp: 170, attack: 14, defense: 9, reward: ['herb', 'potion'], exp: 150 }
        };

        // Bossæ•Œäººå®šä¹‰
        const bossEnemy = {
            name: 'çš±çš®å¤§ç‹',
            hp: 1500,
            maxHp: 1500,
            attack: 35,
            defense: 25,
            specialAttack: true,
            exp: 1000,
            boss: true
        };

        // ç­‰çº§ç»éªŒè¡¨è°ƒæ•´
        const levelExpTable = [0, 100, 200, 200, 300, 400, 500, 500];

        const characters = [
            {
                id: 'xiandi',
                name: 'è¯¸å¤©æœªæ¥ä»™å¸',
                desc: 'å¤©èµ‹å¼‚ç¦€ï¼Œä¿®ç‚¼é€Ÿåº¦æå¿«',
                baseStats: { hp: 120, attack: 15, defense: 8 },
                ability: 'æˆ˜æ–—æ—¶æ”»å‡»åŠ›+20%'
            },
            {
                id: 'yangge',
                name: 'æ²³åŒ—å°æ¨',
                desc: 'èº«æ‰‹æ•æ·ï¼Œæ“…é•¿æ¢ç´¢',
                baseStats: { hp: 100, attack: 12, defense: 10 },
                ability: 'æ¢ç´¢æ—¶é¢å¤–è·å¾—èµ„æº'
            },
            {
                id: 'liushipeng',
                name: 'åˆ˜ä¸–é¹',
                desc: 'åŠ›å¤§æ— ç©·ï¼Œé˜²å¾¡æƒŠäºº',
                baseStats: { hp: 150, attack: 10, defense: 15 },
                ability: 'å—åˆ°ä¼¤å®³å‡å°‘30%'
            },
            {
                id: 'chenyuxin',
                name: 'é™ˆé›¨æ¬£',
                desc: 'ç²¾é€šåŒ»æœ¯ï¼Œæ¢å¤èƒ½åŠ›å¼º',
                baseStats: { hp: 90, attack: 8, defense: 7 },
                ability: 'ä½¿ç”¨æ¢å¤ç‰©å“æ•ˆæœ+50%'
            },
            {
                id: 'guilao',
                name: 'é¬¼å§¥',
                desc: 'è¯¡å¼‚è«æµ‹ï¼Œè‡´å‘½ä¸€å‡»',
                baseStats: { hp: 80, attack: 20, defense: 5 },
                ability: '30%æ¦‚ç‡é€ æˆåŒå€ä¼¤å®³'
            },
            {
                id: 'baihu',
                name: 'ç™½ç‹',
                desc: 'çµå·§ç‹¡é» ï¼Œé—ªé¿é«˜è¶…',
                baseStats: { hp: 95, attack: 13, defense: 8 },
                ability: '25%æ¦‚ç‡é—ªé¿æ”»å‡»'
            },
            {
                id: 'shenDun',
                name: 'ç¥ç›¾',
                desc: 'é˜²å¾¡ä¸“å®¶ï¼Œè¶Šæˆ˜è¶Šå¼º',
                baseStats: { hp: 125, attack: 10, defense: 12 },
                ability: 'æ¯å—åˆ°ä¸€æ¬¡ä¼¤å®³ï¼Œæ”»å‡»åŠ›æå‡5%'
            },
            {
                id: 'panSheng',
                name: 'ç›˜åœ£',
                desc: 'åŠ›é‡ä¸é€Ÿåº¦å®Œç¾ç»“åˆ',
                baseStats: { hp: 110, attack: 18, defense: 9 },
                ability: 'æ”»å‡»æ—¶æœ‰æ¦‚ç‡è§¦å‘"éœ‡æœº"ï¼Œæœ¬è½®ä¼¤å®³æé«˜100%'
            },
            {
                id: 'yinglumine',
                name: 'å› æç“¦ç‰¹Â·è§',
                desc: 'æ¥è‡ªå¼‚ä¸–ç•Œçš„æ—…è€…',
                baseStats: { hp: 105, attack: 14, defense: 11 },
                ability: 'å…ƒç´ èåˆï¼šæ”»å‡»æ—¶é€ æˆé¢å¤–30%ä¼¤å®³'
            },
            {
                id: 'datangwanzi',
                name: 'å¤§å”ä¸¸å­',
                desc: 'é£Ÿè´§æˆä»™ï¼Œç¾é£Ÿä¹‹åŠ›',
                baseStats: { hp: 140, attack: 11, defense: 8 },
                ability: 'è¿›é£Ÿæ—¶æ¢å¤ç”Ÿå‘½å€¼+40%'
            }
        ];

        // ä¿®æ”¹æœ€åä¸¤å…³çš„è§£é”æ¡ä»¶
        const locations = [
            {
                id: 'ruins',
                name: 'âœ¨ ä»™å®¶å†›é—è¿¹',
                description: 'æ›¾ç»çš„å®¶å›­ç°åœ¨åªå‰©æ–­å£æ®‹å£ã€‚åˆ°å¤„æ˜¯è¢«çƒ§ç„¦çš„ç—•è¿¹ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€æ‚²ä¼¤çš„çµæ°”ã€‚è¿™é‡Œæ˜¯ä½ çš„èµ·ç‚¹ï¼Œéœ€è¦åœ¨è¿™é‡Œç§¯è“„åŠ›é‡ã€‚',
                encounters: ['é‡ç‹¼', 'åºŸå¢Ÿå¹½çµ'],
                resources: ['herb', 'wood', 'stone', 'water'],
                unlockCondition: { type: 'start', value: true },
                unlockHint: 'èµ·å§‹åœ°ç‚¹',
                storyOnEnter: 'è¿™é‡Œæ›¾æ˜¯ä½ çš„å®¶å›­...ä½ å‘èª“è¦ä¸ºæ‰€æœ‰æ­»å»çš„åŒä¼´å¤ä»‡ï¼'
            },
            {
                id: 'forest',
                name: 'ğŸŒ² åŸè€é™¢',
                description: 'è¿™ç‰‡åœ°æ–¹è¢«å¦–æ°”æ±¡æŸ“ï¼Œèµ„æºä¸°å¯Œä½†å±é™©é‡é‡ã€‚å¯ä»¥å¬åˆ°å¥‡å¼‚çš„å£°éŸ³åœ¨æ—é—´å›è¡ã€‚',
                encounters: ['åŸè€æ€¨éª‘å£«', 'æ¤°å¥¶é¦™é¦™çš„'],
                resources: ['wood', 'herb', 'meat'],
                unlockCondition: { type: 'level', value: 2 },
                unlockHint: 'éœ€è¦Lv.2',
                storyOnEnter: 'ä½ æ¥åˆ°äº†åŸè€é™¢ï¼Œè¿™é‡Œæ›¾æ˜¯ä»™å®¶å†›çš„è®­ç»ƒåœºï¼Œå¦‚ä»Šè¢«å¦–æ°”ä¾µèš€...'
            },
            {
                id: 'swamp',
                name: 'ğŸœï¸ è¯¡å¼‚æ²¼æ³½',
                description: 'ä¸€ç‰‡æ³¥æ³çš„æ²¼æ³½åœ°ï¼Œæ•£å‘ç€åˆºé¼»çš„æ°”å‘³ã€‚æ²¼æ³½ä¸­å……æ»¡äº†æ¯’æ°”å’Œå±é™©çš„ç”Ÿç‰©ï¼Œä½†æœ‰å……è¶³çš„æ°´æºã€‚',
                encounters: ['å°çš±çš®', 'è›™è›™'],
                resources: ['water', 'herb', 'wood'],
                unlockCondition: { type: 'level', value: 3 },
                unlockHint: 'éœ€è¦Lv.3',
                storyOnEnter: 'åœ¨æ²¼æ³½ä¸­ï¼Œä½ å‘ç°äº†ä¸€äº›å…³äºçš±çš®å¤§ç‹è¡Œè¸ªçš„çº¿ç´¢...'
            },
            {
                id: 'cooldog',
                name: 'ğŸ• é…·çŠ¬å±±',
                description: 'ä¸€åº§é™¡å³­çš„å±±å³°ï¼Œå±±ä¸Šä½ç€è®¸å¤šå‡¶æ‚çš„çŒ›å…½ã€‚è¿™é‡Œçš„ç”Ÿç‰©éƒ½å¼‚å¸¸å‡¶æ®‹ï¼Œä½†èµ„æºä¹Ÿæå…¶ä¸°å¯Œã€‚',
                encounters: ['è·¯è¾¹ä¸€æ¡', 'é…·é…·çš„ç‹—'],
                resources: ['meat', 'stone', 'iron'],
                unlockCondition: { type: 'level', value: 4 },
                unlockHint: 'éœ€è¦Lv.4',
                storyOnEnter: 'å±±é¡¶ä¼ æ¥å¼‚æ ·çš„åšå«ï¼Œæœ‰å¼ºå¤§çš„ç”Ÿç‰©åœ¨æ­¤å®ˆæŠ¤ç€ä»€ä¹ˆ...'
            },
            {
                id: 'company',
                name: 'ğŸ¢ æ¶é­”å…¬å¸',
                description: 'ä¸€åº§è¯¡å¼‚çš„ç°ä»£å»ºç­‘çŸ—ç«‹åœ¨è’é‡ä¸­ã€‚è¿™æ˜¯çš±çš®å¤§ç‹çš„æ®ç‚¹ä¹‹ä¸€ï¼Œå……æ»¡äº†é‚ªæ¶çš„æ°”æ¯ã€‚',
                encounters: ['å…¬å¸å‘˜å·¥', 'æ¶é­”', 'åˆ˜ä¼Ÿ'],
                resources: ['iron', 'stone', 'potion'],
                unlockCondition: { type: 'defeated', value: 'é…·é…·çš„ç‹—' },
                unlockHint: 'éœ€è¦å‡»è´¥é…·é…·çš„ç‹—',
                storyOnEnter: 'ä½ æ½œå…¥äº†æ¶é­”å…¬å¸æ€»éƒ¨ï¼Œå‘ç°äº†çš±çš®å¤§ç‹æ‰©å¼ è®¡åˆ’çš„è¯¦ç»†æ¡£æ¡ˆ...'
            },
            {
                id: 'cave',
                name: 'â›°ï¸ ngaæ´çªŸ',
                description: 'ä¸€ä¸ªæ·±ä¸è§åº•çš„é»‘æš—æ´çªŸã€‚é‡Œé¢ä¼ æ¥ä½æ²‰çš„å¼å£°å’Œå¥‡å¼‚çš„æ°”å‘³ã€‚æ®è¯´çš±çš®å¤§ç‹çš„ç²¾é”éƒ¨é˜Ÿåœ¨è¿™é‡Œä¿®è¡Œ...',
                encounters: ['çŒ´å­', 'ç±³é»˜'],
                resources: ['iron', 'herb', 'stone'],
                unlockCondition: { type: 'level', value: 5 },
                unlockHint: 'éœ€è¦Lv.5',
                storyOnEnter: 'æ´çªŸæ·±å¤„ä¼ æ¥å¤è€çš„ä½è¯­ï¼Œä¼¼ä¹åœ¨è¯‰è¯´ç€ä»€ä¹ˆç§˜å¯†...'
            },
            {
                id: 'temple',
                name: 'ğŸ¯ åºŸå¼ƒç¥åº™',
                description: 'ä¸€åº§å¤è€çš„ç¥åº™è¢«å²æœˆä¾µèš€ã€‚è¿™é‡Œæ›¾ç»æ˜¯äººç±»æ±‚ç¥çš„åœ°æ–¹ï¼Œç°åœ¨æ²¦ä¸ºäº†å¦–æ€ªçš„å·¢ç©´ã€‚',
                encounters: ['æ¡£å«å…µ', 'éº»è¾£ä»™äºº'],
                resources: ['potion', 'herb', 'wood'],
                unlockCondition: { type: 'attack', value: 150 },
                unlockHint: 'éœ€è¦æ”»å‡»åŠ›â‰¥150',
                storyOnEnter: 'åœ¨ç¥åº™çš„ç¥­å›ä¸Šï¼Œä½ å‘ç°äº†å‰Šå¼±çš±çš®å¤§ç‹çš„å¤è€ä»ªå¼...'
            },
            {
                id: 'fortress',
                name: 'ğŸ‘‘ æ°¸å¤œå ¡å’',
                description: 'çš±çš®å¤§ç‹çš„æœ€ç»ˆæ®ç‚¹ï¼è¿™åº§å ¡å’å……æ»¡äº†ç»æœ›çš„é»‘æš—åŠ›é‡ã€‚åªæœ‰åšå¥½å……è¶³å‡†å¤‡çš„äººæ‰èƒ½åœ¨è¿™é‡Œæ´»ä¸‹æ¥...è¿™é‡Œæ˜¯æœ€ç»ˆçš„æˆ˜æ–—åœ°ç‚¹ï¼',
                encounters: ['boss'],
                resources: [],
                unlockCondition: { type: 'attack', value: 200 },
                unlockHint: 'éœ€è¦æ”»å‡»åŠ›â‰¥200',
                storyOnEnter: 'è¿™å°±æ˜¯å¤ä»‡çš„ç»ˆç‚¹...ä½ çš„å®¿æ•Œå°±åœ¨å‰æ–¹ï¼'
            }
        ];

        const items = {
            food: { 
                name: 'é£Ÿç‰©', 
                hunger: 30, 
                thirst: 0,
                effect: 'æ¢å¤30é¥±é£Ÿåº¦'
            },
            water: { 
                name: 'æ¸…æ°´', 
                hunger: 0, 
                thirst: 40,
                effect: 'æ¢å¤40é¥¥æ¸´åº¦'
            },
            meat: { 
                name: 'çƒ¤è‚‰', 
                hunger: 50, 
                thirst: -10,
                effect: 'æ¢å¤50é¥±é£Ÿåº¦ï¼Œå‡å°‘10é¥¥æ¸´åº¦'
            },
            herb: { 
                name: 'è‰è¯', 
                hp: 30,
                effect: 'æ¢å¤30ç”Ÿå‘½å€¼'
            },
            potion: { 
                name: 'æ²»ç–—è¯æ°´', 
                hp: 60,
                effect: 'æ¢å¤60ç”Ÿå‘½å€¼'
            },
            wood: { 
                name: 'æœ¨æ', 
                craftMaterial: true,
                effect: 'åˆæˆææ–™'
            },
            stone: { 
                name: 'çŸ³å¤´', 
                craftMaterial: true,
                effect: 'åˆæˆææ–™'
            },
            iron: { 
                name: 'é“çŸ¿', 
                craftMaterial: true,
                effect: 'åˆæˆææ–™'
            },
            soul_fragment: { 
                name: 'çµé­‚ç¢ç‰‡', 
                special: true, 
                description: 'çš±çš®å¤§ç‹çš„åŠ›é‡æ¥æºä¹‹ä¸€',
                effect: 'åˆæˆä¼ å¥‡æ­¦å™¨'
            }
        };

        const recipes = [
            {
                name: 'æœ¨æ£',
                materials: { wood: 2 },
                result: { attack: 5, defense: 0 },
                desc: 'ç®€æ˜“æ­¦å™¨ï¼Œå¢åŠ 5ç‚¹æ”»å‡»'
            },
            {
                name: 'çŸ³æ–§',
                materials: { wood: 2, stone: 3 },
                result: { attack: 12, defense: 0 },
                desc: 'åšå›ºæ­¦å™¨ï¼Œå¢åŠ 12ç‚¹æ”»å‡»'
            },
            {
                name: 'é“å‰‘',
                materials: { wood: 1, iron: 5 },
                result: { attack: 25, defense: 0 },
                desc: 'é”‹åˆ©æ­¦å™¨ï¼Œå¢åŠ 25ç‚¹æ”»å‡»'
            },
            {
                name: 'æœ¨ç›¾',
                materials: { wood: 4 },
                result: { attack: 0, defense: 8 },
                desc: 'é˜²æŠ¤è£…å¤‡ï¼Œå¢åŠ 8ç‚¹é˜²å¾¡'
            },
            {
                name: 'é“ç”²',
                materials: { iron: 8, stone: 3 },
                result: { attack: 0, defense: 20 },
                desc: 'åšå›ºæŠ¤ç”²ï¼Œå¢åŠ 20ç‚¹é˜²å¾¡'
            },
            {
                name: 'æ²»ç–—è¯æ°´',
                materials: { herb: 3, water: 1 },
                result: { item: 'potion' },
                desc: 'æ¢å¤60ç‚¹ç”Ÿå‘½å€¼'
            },
            {
                name: 'ç¥åœ£ä¹‹å‰‘',
                materials: { iron: 10, soul_fragment: 2 },
                result: { attack: 40, defense: 0 },
                desc: 'ä¼ å¥‡æ­¦å™¨ï¼Œèƒ½å¯¹çš±çš®å¤§ç‹é€ æˆåŒå€ä¼¤å®³'
            }
        ];

        let gameState = {
            selectedCharacter: null,
            currentLocation: 'ruins',
            player: {
                name: '',
                level: 1,
                exp: 0,
                hp: 100,
                maxHp: 100,
                hunger: 100,
                maxHunger: 100,
                thirst: 100,
                maxThirst: 100,
                baseAttack: 10,
                baseDefense: 5,
                bonusAttack: 0,
                bonusDefense: 0,
                ability: '',
                attributes: {
                    strength: 0,
                    vitality: 0,
                    endurance: 0,
                    agility: 0
                },
                attackBoost: 0,
                isZhenJi: false
            },
            inventory: {},
            currentEnemy: null,
            inBattle: false,
            battleEnded: false,
            turnsAlived: 0,
            bossDefeated: false,
            unlockedLocations: new Set(['ruins']),
            visitedLocations: new Set(),
            defeatedBosses: new Set(),
            storyProgress: 0,
            savedAlly: false
        };

        let attributePoints = 10;

        // âœ… åˆ†ç¦»çš„è°ƒè¯•å‡½æ•°1ï¼šè§£é”æ‰€æœ‰åœ°å›¾
        function unlockAllMaps() {
            activateAudioOnUserInteraction();
            playClickSound();
            // è§£é”æ‰€æœ‰åœ°å›¾
            for (let i = 0; i < locations.length; i++) {
                gameState.unlockedLocations.add(locations[i].id);
            }
            // åˆ·æ–°æ˜¾ç¤º
            if (document.getElementById('game-screen').classList.contains('active')) {
                initLocationButtons();
                addGameLog('<div class="heal" style="font-size: 1.1em; padding: 12px; background: rgba(33, 150, 243, 0.3); border-radius: 8px; margin: 10px 0;">ğŸ—ºï¸ å·²è§£é”æ‰€æœ‰åœ°å›¾ï¼</div>');
                updateProgressDisplay();
            }
            alert('âœ… æ‰€æœ‰åœ°å›¾å·²è§£é”ï¼');
        }

        // âœ… åˆ†ç¦»çš„è°ƒè¯•å‡½æ•°2ï¼šè·å¾—æ‰€æœ‰ç‰©èµ„
        function addAllResources() {
            activateAudioOnUserInteraction();
            playClickSound();
            // è®¾ç½®æ‰€æœ‰ç‰©èµ„ä¸º999
            for (let itemId in items) {
                gameState.inventory[itemId] = 999;
            }
            // åˆ·æ–°æ˜¾ç¤º
            if (document.getElementById('game-screen').classList.contains('active')) {
                addGameLog('<div class="heal" style="font-size: 1.1em; padding: 12px; background: rgba(156, 39, 176, 0.3); border-radius: 8px; margin: 10px 0;">ğŸ“¦ è·å¾—æ‰€æœ‰ç‰©èµ„999ä¸ªï¼</div>');
                updateStatusBar();
            }
            alert('âœ… æ‰€æœ‰ç‰©èµ„å·²è®¾ä¸º999ï¼');
        }

        function initCharacterSelection() {
            activateAudioOnUserInteraction();
            const characterList = document.getElementById('character-list');
            characterList.innerHTML = '';
            characters.forEach(char => {
                const card = document.createElement('div');
                card.className = 'character-card';
                card.onclick = () => {
                    activateAudioOnUserInteraction();
                    playClickSound();
                    selectCharacter(char.id);
                };
                card.id = `char-${char.id}`;
                card.innerHTML = `
                    <div>
                        <div class="character-name">${char.name}</div>
                        <div class="character-desc">${char.desc}</div>
                        <div class="character-stats">
                            ç”Ÿå‘½: ${char.baseStats.hp} | 
                            æ”»å‡»: ${char.baseStats.attack} | 
                            é˜²å¾¡: ${char.baseStats.defense}
                        </div>
                    </div>
                    <div class="character-ability">
                        â­ ${char.ability}
                    </div>
                `;
                characterList.appendChild(card);
            });
            playMusic('main');
        }

        function selectCharacter(charId) {
            document.querySelectorAll('.character-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById(`char-${charId}`).classList.add('selected');
            gameState.selectedCharacter = characters.find(c => c.id === charId);
            document.getElementById('select-char-btn').disabled = false;
        }

        function startAttributeAllocation() {
            if (!gameState.selectedCharacter) return;
            activateAudioOnUserInteraction();
            playClickSound();
            if (gameState.selectedCharacter.id === 'chenyuxin') {
                document.getElementById('chenyuxin-modal').classList.add('active');
                return;
            }
            document.getElementById('intro-screen').classList.remove('active');
            document.getElementById('attribute-screen').classList.add('active');
            initAttributePanel();
        }

        function acceptConfession() {
            activateAudioOnUserInteraction();
            playClickSound();
            document.getElementById('chenyuxin-modal').classList.remove('active');
            document.getElementById('intro-screen').classList.remove('active');
            document.getElementById('attribute-screen').classList.add('active');
            initAttributePanel();
        }

        function rejectConfession() {
            activateAudioOnUserInteraction();
            playClickSound();
            const modal = document.getElementById('chenyuxin-modal');
            const rejectBtn = document.getElementById('reject-btn');
            const randomX = Math.random() * (window.innerWidth - 100);
            const randomY = Math.random() * (window.innerHeight - 50);
            rejectBtn.style.position = 'fixed';
            rejectBtn.style.left = randomX + 'px';
            rejectBtn.style.top = randomY + 'px';
            rejectBtn.style.zIndex = '1001';
        }

        function initAttributePanel() {
            const panel = document.getElementById('attribute-panel');
            const attrs = ['strength', 'åŠ›é‡ (æ”»å‡»+2)', 'vitality', 'ä½“è´¨ (ç”Ÿå‘½+10)', 'endurance', 'è€åŠ› (é˜²å¾¡+2)', 'agility', 'æ•æ· (é—ªé¿+2%)'];
            panel.innerHTML = '';
            for (let i = 0; i < attrs.length; i += 2) {
                const attrKey = attrs[i];
                const attrName = attrs[i + 1];
                const item = document.createElement('div');
                item.className = 'attribute-item';
                item.innerHTML = `
                    <span>${attrName}</span>
                    <div class="attribute-controls">
                        <button class="attr-btn" onclick="decreaseAttr('${attrKey}')">-</button>
                        <span class="attr-value" id="attr-${attrKey}">0</span>
                        <button class="attr-btn" onclick="increaseAttr('${attrKey}')">+</button>
                    </div>
                `;
                panel.appendChild(item);
            }
            updateAttributeDisplay();
        }

        function increaseAttr(attr) {
            if (attributePoints > 0) {
                activateAudioOnUserInteraction();
                playClickSound();
                gameState.player.attributes[attr]++;
                attributePoints--;
                updateAttributeDisplay();
            }
        }

        function decreaseAttr(attr) {
            if (gameState.player.attributes[attr] > 0) {
                activateAudioOnUserInteraction();
                playClickSound();
                gameState.player.attributes[attr]--;
                attributePoints++;
                updateAttributeDisplay();
            }
        }

        function updateAttributeDisplay() {
            document.getElementById('points-remaining').textContent = attributePoints;
            for (let attr in gameState.player.attributes) {
                document.getElementById(`attr-${attr}`).textContent = gameState.player.attributes[attr];
            }
        }

        function startGame() {
            activateAudioOnUserInteraction();
            playClickSound();
            const char = gameState.selectedCharacter;
            const attrs = gameState.player.attributes;
            gameState.player.name = char.name;
            gameState.player.maxHp = char.baseStats.hp + attrs.vitality * 10;
            gameState.player.hp = gameState.player.maxHp;
            gameState.player.baseAttack = char.baseStats.attack + attrs.strength * 2;
            gameState.player.baseDefense = char.baseStats.defense + attrs.endurance * 2;
            gameState.player.ability = char.ability;
            gameState.player.agility = attrs.agility * 2;
            gameState.inventory = {
                food: 3,
                water: 3,
                herb: 2,
                wood: 5,
                stone: 2
            };
            document.getElementById('attribute-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            playMusic('normal');
            initLocationButtons();
            updateStatusBar();
            updateCharacterDisplay();
            updateProgressDisplay();
            addGameLog('æ¸¸æˆå¼€å§‹ï¼ä½ åœ¨ä»™å®¶å†›çš„é—è¿¹ä¸­é†’æ¥...');
            addGameLog('<div class="hint-box">ğŸ’¡ æ–°æ‰‹æŒ‡å¼•ï¼šå…ˆåœ¨é—è¿¹æ¢ç´¢è·å–èµ„æºï¼Œå‡»è´¥æ•Œäººè·å¾—ç»éªŒå‡çº§ï¼Œè¾¾åˆ°Lv.2åå¯è§£é”åŸè€é™¢ï¼</div>');
        }

        function checkLocationUnlock(location) {
            const condition = location.unlockCondition;
            if (condition.type === 'start') return true;
            if (condition.type === 'level') return gameState.player.level >= condition.value;
            if (condition.type === 'attack') {
                const totalAttack = gameState.player.baseAttack + gameState.player.bonusAttack;
                return totalAttack >= condition.value;
            }
            if (condition.type === 'power') {
                const totalPower = gameState.player.baseAttack + gameState.player.bonusAttack + gameState.player.baseDefense + gameState.player.bonusDefense;
                return totalPower >= condition.value;
            }
            if (condition.type === 'defeated') return gameState.defeatedBosses.has(condition.value);
            return false;
        }

        function initLocationButtons() {
            const nav = document.getElementById('location-nav');
            nav.innerHTML = '';
            locations.forEach(loc => {
                const isUnlocked = checkLocationUnlock(loc) || gameState.unlockedLocations.has(loc.id);
                const btn = document.createElement('button');
                btn.className = 'location-btn';
                if (!isUnlocked) {
                    btn.classList.add('locked');
                    btn.title = loc.unlockHint;
                    btn.disabled = true;
                } else if (loc.id === gameState.currentLocation) {
                    btn.classList.add('active');
                }
                btn.innerHTML = `
                    ${loc.name}
                    ${!isUnlocked ? '<div class="unlock-hint">' + loc.unlockHint + '</div>' : ''}
                `;
                btn.onclick = () => {
                    if (isUnlocked) {
                        activateAudioOnUserInteraction();
                        playClickSound();
                        travelToLocation(loc.id);
                    }
                };
                nav.appendChild(btn);
            });
        }

        function updateProgressDisplay() {
            const level = gameState.player.level;
            const exp = gameState.player.exp;
            const nextLevelExp = levelExpTable[level] || 99999;
            const expPercent = (exp / nextLevelExp * 100).toFixed(1);
            document.getElementById('level-display').textContent = `Lv.${level}`;
            document.getElementById('exp-fill').style.width = `${expPercent}%`;
            document.getElementById('exp-text').textContent = `${exp}/${nextLevelExp}`;
            document.getElementById('unlock-progress').textContent = `${gameState.unlockedLocations.size}/8 åœ°å›¾`;
        }

        function gainExp(amount) {
            gameState.player.exp += amount;
            const level = gameState.player.level;
            const nextLevelExp = levelExpTable[level];
            if (nextLevelExp && gameState.player.exp >= nextLevelExp) {
                levelUp();
            }
            updateProgressDisplay();
        }

        function levelUp() {
            gameState.player.level++;
            gameState.player.exp = 0;
            const hpBonus = 10;
            const attackBonus = 2;
            const defenseBonus = 1;
            gameState.player.maxHp += hpBonus;
            gameState.player.hp = gameState.player.maxHp;
            gameState.player.baseAttack += attackBonus;
            gameState.player.baseDefense += defenseBonus;
            addGameLog(`<div class="heal" style="font-size: 1.2em; padding: 10px; background: rgba(76, 175, 80, 0.2); border-radius: 8px; margin: 10px 0;">
                ğŸŠ å‡çº§äº†ï¼ç­‰çº§æå‡è‡³ Lv.${gameState.player.level}ï¼<br>
                ç”Ÿå‘½ä¸Šé™+${hpBonus}ï¼Œæ”»å‡»åŠ›+${attackBonus}ï¼Œé˜²å¾¡åŠ›+${defenseBonus}
            </div>`);
            checkAndUnlockLocations();
            updateProgressDisplay();
            updateStatusBar();
        }

        function checkAndUnlockLocations() {
            let newUnlocks = [];
            locations.forEach(loc => {
                if (!gameState.unlockedLocations.has(loc.id) && checkLocationUnlock(loc)) {
                    gameState.unlockedLocations.add(loc.id);
                    newUnlocks.push(loc);
                }
            });
            if (newUnlocks.length > 0) {
                newUnlocks.forEach(loc => {
                    showUnlockNotification(loc);
                });
                initLocationButtons();
            }
        }

        function showUnlockNotification(location) {
            const modal = document.getElementById('unlock-modal');
            const text = document.getElementById('unlock-text');
            text.innerHTML = `
                æ­å–œï¼ä½ è§£é”äº†æ–°åœ°å›¾ï¼š<br>
                <span style="color: #ffd54f; font-size: 1.3em;">${location.name}</span><br><br>
                <span style="color: #64b5f6;">${location.storyOnEnter}</span>
            `;
            modal.classList.add('active');
        }

        function closeUnlockModal() {
            playClickSound();
            document.getElementById('unlock-modal').classList.remove('active');
        }

        function travelToLocation(locationId) {
            if (!gameState.unlockedLocations.has(locationId)) {
                addGameLog('âš ï¸ è¯¥åœ°å›¾å°šæœªè§£é”ï¼');
                return;
            }
            gameState.currentLocation = locationId;
            gameState.turnsAlived++;
            gameState.visitedLocations.add(locationId);
            const location = locations.find(l => l.id === locationId);
            const content = document.getElementById('game-content');
            content.innerHTML = '';
            addGameLog(`ğŸ“ ä½ æ¥åˆ°äº† ${location.name}`);
            addGameLog(location.description);
            if (!gameState.visitedLocations.has(locationId + '_story')) {
                addGameLog(`<div style="background: rgba(100, 181, 246, 0.1); padding: 15px; border-left: 4px solid #64b5f6; border-radius: 5px; margin: 10px 0;">
                    ${location.storyOnEnter}
                </div>`);
                gameState.visitedLocations.add(locationId + '_story');
            }
            gameState.player.hunger -= 3;
            gameState.player.thirst -= 5;
            updateStatusBar();
            updateLocationDisplay();
            initLocationButtons();
            checkSurvival();
            
            if (locationId === 'fortress') {
                addGameLog('<div style="background: rgba(255, 50, 50, 0.2); padding: 15px; border-left: 4px solid #f44336; border-radius: 5px; margin: 10px 0; font-size: 1.1em; color: #ff6b6b;">âš ï¸ çš±çš®å¤§ç‹æ„ŸçŸ¥åˆ°äº†ä½ çš„å­˜åœ¨ï¼æˆ˜æ–—å³å°†å¼€å§‹ï¼</div>');
                setTimeout(() => {
                    startBossBattle();
                }, 2000);
            }
        }

        function updateLocationDisplay() {
            const location = locations.find(l => l.id === gameState.currentLocation);
            document.getElementById('location-display').textContent = location.name;
        }

        function updateCharacterDisplay() {
            document.getElementById('character-name').textContent = gameState.player.name;
        }

        function updateStatusBar() {
            const p = gameState.player;
            document.getElementById('hp-display').textContent = `${Math.max(0, p.hp)}/${p.maxHp}`;
            document.getElementById('hunger-display').textContent = `${Math.max(0, p.hunger)}/${p.maxHunger}`;
            document.getElementById('thirst-display').textContent = `${Math.max(0, p.thirst)}/${p.maxThirst}`;
            const totalAttack = p.baseAttack + p.bonusAttack + p.attackBoost;
            const totalDefense = p.baseDefense + p.bonusDefense;
            document.getElementById('attack-display').textContent = totalAttack;
            document.getElementById('defense-display').textContent = totalDefense;
            if (p.hp <= 0) gameOver(false);
        }

        function addGameLog(message) {
            const content = document.getElementById('game-content');
            const p = document.createElement('p');
            p.innerHTML = message;
            p.style.marginTop = '10px';
            content.appendChild(p);
            content.scrollTop = content.scrollHeight;
        }

        function explore() {
            activateAudioOnUserInteraction();
            playClickSound();
            gameState.turnsAlived++;
            gameState.player.hunger -= 5;
            gameState.player.thirst -= 8;
            const location = locations.find(l => l.id === gameState.currentLocation);
            const rand = Math.random();
            if (rand < 0.4) {
                const resources = location.resources;
                if (resources && resources.length > 0) {
                    const foundResource = resources[Math.floor(Math.random() * resources.length)];
                    let amount = Math.floor(Math.random() * 3) + 1;
                    if (gameState.player.name === 'æ²³åŒ—å°æ¨') amount = Math.floor(amount * 1.5);
                    addToInventory(foundResource, amount);
                    addGameLog(`ğŸ‰ æ¢ç´¢æˆåŠŸï¼ä½ å‘ç°äº† ${items[foundResource].name} x${amount}`);
                }
            } else if (rand < 0.7) {
                startBattle(location);
            } else {
                addGameLog('ä½ åœ¨ ' + location.name + ' ä¸­æœç´¢ï¼Œä½†ä»€ä¹ˆéƒ½æ²¡æ‰¾åˆ°...');
            }
            updateStatusBar();
            checkSurvival();
        }

        function showInventory() {
            activateAudioOnUserInteraction();
            playClickSound();
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('inventory-screen').classList.add('active');
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = '';
            if (Object.keys(gameState.inventory).length === 0) {
                inventoryList.innerHTML = '<p style="text-align: center; color: #bbb;">èƒŒåŒ…æ˜¯ç©ºçš„</p>';
                return;
            }
            for (let itemId in gameState.inventory) {
                if (gameState.inventory[itemId] > 0) {
                    const item = items[itemId];
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.onclick = () => useItem(itemId);
                    div.innerHTML = `
                        <div class="item-name">${item.name}</div>
                        <div class="item-count">x${gameState.inventory[itemId]}</div>
                        <div class="item-effect">${item.effect}</div>
                    `;
                    inventoryList.appendChild(div);
                }
            }
        }

        function useItem(itemId) {
            if (!gameState.inventory[itemId] || gameState.inventory[itemId] <= 0) return;
            activateAudioOnUserInteraction();
            playClickSound();
            const item = items[itemId];
            if (item.craftMaterial || item.special) {
                addGameLog(`${item.name} ä¸èƒ½ç›´æ¥ä½¿ç”¨`);
                return;
            }
            let used = false;
            let message = '';
            if (item.hp) {
                let healAmount = item.hp;
                if (gameState.player.name === 'é™ˆé›¨æ¬£') healAmount = Math.floor(healAmount * 1.5);
                if (gameState.player.name === 'å¤§å”ä¸¸å­' && itemId === 'meat') healAmount = Math.floor(healAmount * 1.4);
                gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + healAmount);
                message = `ä½¿ç”¨äº† ${item.name}ï¼Œæ¢å¤äº† ${healAmount} ç‚¹ç”Ÿå‘½å€¼`;
                used = true;
            }
            if (item.hunger && item.hunger > 0) {
                gameState.player.hunger = Math.min(gameState.player.maxHunger, gameState.player.hunger + item.hunger);
                if (message) message += 'ï¼Œ';
                message += `æ¢å¤äº†${item.hunger}é¥±é£Ÿåº¦`;
                used = true;
            }
            if (item.thirst && item.thirst > 0) {
                gameState.player.thirst = Math.min(gameState.player.maxThirst, gameState.player.thirst + item.thirst);
                if (message) message += 'ï¼Œ';
                message += `æ¢å¤äº†${item.thirst}é¥¥æ¸´åº¦`;
                used = true;
            }
            if (used) {
                gameState.inventory[itemId]--;
                addGameLog(`âœ… ${message}`);
                updateStatusBar();
                showInventory();
            }
        }

        function showCraft() {
            activateAudioOnUserInteraction();
            playClickSound();
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('craft-screen').classList.add('active');
            const recipesList = document.getElementById('craft-recipes');
            recipesList.innerHTML = '';
            recipes.forEach((recipe, index) => {
                const canCraft = checkCanCraft(recipe);
                const div = document.createElement('div');
                div.className = 'recipe';
                let materialsText = '';
                for (let mat in recipe.materials) {
                    const need = recipe.materials[mat];
                    const have = gameState.inventory[mat] || 0;
                    materialsText += `${items[mat].name}: ${have}/${need} `;
                }
                div.innerHTML = `
                    <div class="recipe-info">
                        <div class="recipe-name">${recipe.name}</div>
                        <div class="recipe-materials">ææ–™: ${materialsText}</div>
                        <div style="color: #64b5f6; font-size: 0.85em; margin-top: 5px;">${recipe.desc}</div>
                    </div>
                    <button class="btn ${canCraft ? 'btn-primary' : 'btn-disabled'}" 
                            onclick="craft(${index})" 
                            ${canCraft ? '' : 'disabled'}>
                        åˆæˆ
                    </button>
                `;
                recipesList.appendChild(div);
            });
        }

        function checkCanCraft(recipe) {
            for (let mat in recipe.materials) {
                if (!gameState.inventory[mat] || gameState.inventory[mat] < recipe.materials[mat]) return false;
            }
            return true;
        }

        function craft(recipeIndex) {
            activateAudioOnUserInteraction();
            playClickSound();
            const recipe = recipes[recipeIndex];
            if (!checkCanCraft(recipe)) return;
            for (let mat in recipe.materials) gameState.inventory[mat] -= recipe.materials[mat];
            if (recipe.result.item) {
                addToInventory(recipe.result.item, 1);
                addGameLog(`ğŸ”¨ æˆåŠŸåˆæˆäº† ${items[recipe.result.item].name}ï¼`);
            } else {
                if (recipe.result.attack) {
                    gameState.player.bonusAttack += recipe.result.attack;
                    addGameLog(`ğŸ”¨ æˆåŠŸåˆæˆäº† ${recipe.name}ï¼æ”»å‡»åŠ› +${recipe.result.attack}`);
                }
                if (recipe.result.defense) {
                    gameState.player.bonusDefense += recipe.result.defense;
                    addGameLog(`ğŸ”¨ æˆåŠŸåˆæˆäº† ${recipe.name}ï¼é˜²å¾¡åŠ› +${recipe.result.defense}`);
                }
            }
            gainExp(20);
            updateStatusBar();
            checkAndUnlockLocations();
            showCraft();
        }

        function rest() {
            activateAudioOnUserInteraction();
            playClickSound();
            gameState.turnsAlived++;
            const healAmount = Math.floor(gameState.player.maxHp * 0.3);
            gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + healAmount);
            gameState.player.hunger -= 10;
            gameState.player.thirst -= 10;
            addGameLog(`ğŸ˜´ ä½ åœ¨ ${locations.find(l => l.id === gameState.currentLocation).name} ä¼‘æ¯äº†ï¼Œæ¢å¤äº† ${healAmount} ç‚¹ç”Ÿå‘½å€¼`);
            updateStatusBar();
            checkSurvival();
        }

        function startBattle(location) {
            const enemyNames = location.encounters;
            const enemyName = enemyNames[Math.floor(Math.random() * enemyNames.length)];
            
            if (enemyName === 'boss') {
                startBossBattle();
                return;
            }
            
            const enemy = JSON.parse(JSON.stringify(enemies[enemyName]));
            enemy.maxHp = enemy.hp;
            enemy.name = enemyName;
            gameState.currentEnemy = enemy;
            gameState.inBattle = true;
            gameState.battleEnded = false;
            gameState.player.isZhenJi = false;
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('battle-screen').classList.add('active');
            playMusic('fight');
            document.getElementById('enemy-name').textContent = enemyName;
            document.getElementById('enemy-hp').textContent = `${enemy.hp}/${enemy.maxHp}`;
            const battleLog = document.getElementById('battle-log');
            if (enemyName === 'é…·é…·çš„ç‹—') {
                battleLog.innerHTML = `
                    <p>ä½ åœ¨é…·çŠ¬å±±çš„å±±é¡¶é‡åˆ°äº†ä¸€åªä½“å‹å·¨å¤§çš„æ€ªç‰©ï¼</p>
                    <p>å®ƒæœ‰ç€é£˜é€¸çš„æ¯›å‘ï¼Œé…·ç‚«çš„å¤–å½¢ï¼Œæ­£æ˜¯ä¼ è¯´ä¸­çš„"é…·é…·çš„ç‹—"ï¼</p>
                    <p class="damage">ğŸ• é…·é…·çš„ç‹—å‘å‡ºäº†ä¸€å£°éœ‡å¤©çš„åšå«ï¼š"æ•¢å…¥ä¾µæˆ‘çš„é¢†åœ°ï¼Ÿå°å°æˆ‘çš„æ€’ç«ï¼"</p>
                `;
            } else {
                battleLog.innerHTML = `<p>åœ¨ ${location.name} ä¸­ï¼Œä½ é­é‡äº† ${enemyName}ï¼</p>`;
            }
            document.getElementById('attack-btn').disabled = false;
            document.getElementById('heal-btn').disabled = false;
            document.getElementById('flee-btn').disabled = false;
        }

        function startBossBattle() {
            const boss = JSON.parse(JSON.stringify(bossEnemy));
            gameState.currentEnemy = boss;
            gameState.inBattle = true;
            gameState.battleEnded = false;
            gameState.player.isZhenJi = false;
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('battle-screen').classList.add('active');
            playMusic('fight');
            document.getElementById('enemy-name').textContent = boss.name;
            document.getElementById('enemy-hp').textContent = `${boss.hp}/${boss.maxHp}`;
            const battleLog = document.getElementById('battle-log');
            battleLog.innerHTML = `
                <p>ä½ è¸å…¥äº†æ°¸å¤œå ¡å’ï¼Œåˆºéª¨çš„å¯’é£è¿é¢å¹æ¥ã€‚</p>
                <p>é˜´æ£®çš„å…‰çº¿ç…§äº®äº†å‘¨å›´ã€‚æœ€ä¸­å¤®çš„ç‹åº§ä¸Šï¼Œåç€é‚£ä¸ªä»¤äººææƒ§çš„èº«å½±â€”â€”çš±çš®å¤§ç‹ï¼</p>
                <p>å®ƒçš„èº«èº¯åºå¤§æ— æ¯”ï¼Œå……æ»¡äº†é‚ªæ¶çš„åŠ›é‡ã€‚æ— æ•°çµé­‚åœ¨å®ƒå‘¨å›´å“­å–Šã€‚</p>
                <p class="damage" style="color: #ff1744;">çš±çš®å¤§ç‹å‘å‡ºäº†éœ‡å¤©çš„æ€’å¼ï¼š"åˆæœ‰ä¸€ä¸ªå‡¡äººæ•¢æ¥æŒ‘æˆ˜æˆ‘ï¼Ÿä½ ä»¬éƒ½ä¼šæ²¦ä¸ºæˆ‘çš„å…»åˆ†ï¼"</p>
            `;
            document.getElementById('attack-btn').disabled = false;
            document.getElementById('heal-btn').disabled = false;
            document.getElementById('flee-btn').disabled = false;
        }

        function attack() {
            if (!gameState.inBattle || !gameState.currentEnemy || gameState.battleEnded) return;
            activateAudioOnUserInteraction();
            playClickSound();
            const enemy = gameState.currentEnemy;
            const player = gameState.player;
            const battleLog = document.getElementById('battle-log');
            
            let basePlayerDamage = player.baseAttack + player.bonusAttack + player.attackBoost;
            let playerDamage = basePlayerDamage - enemy.defense;
            playerDamage = Math.max(Math.floor(basePlayerDamage * 0.2), playerDamage);
            
            if (player.name === 'è¯¸å¤©æœªæ¥ä»™å¸') playerDamage = Math.floor(playerDamage * 1.2);
            if (player.name === 'ç›˜åœ£' && Math.random() < 0.35) {
                playerDamage *= 2;
                battleLog.innerHTML += `<p class="damage">âš¡ è§¦å‘"éœ‡æœº"ï¼æœ¬è½®ä¼¤å®³æé«˜100%ï¼Œé€ æˆ ${playerDamage} ç‚¹ä¼¤å®³ï¼</p>`;
            } else if (player.name === 'å› æç“¦ç‰¹Â·è§') {
                playerDamage = Math.floor(playerDamage * 1.3);
                battleLog.innerHTML += `<p class="damage">ğŸŒŸ å…ƒç´ èåˆï¼é€ æˆ ${playerDamage} ç‚¹ä¼¤å®³</p>`;
            } else if (player.name === 'é¬¼å§¥' && Math.random() < 0.3) {
                playerDamage *= 2;
                battleLog.innerHTML += `<p class="damage">ğŸ’€ è‡´å‘½ä¸€å‡»ï¼é€ æˆ ${playerDamage} ç‚¹ä¼¤å®³ï¼</p>`;
            } else {
                battleLog.innerHTML += `<p class="damage">âš”ï¸ ä½ æ”»å‡»äº† ${enemy.name}ï¼Œé€ æˆ ${playerDamage} ç‚¹ä¼¤å®³</p>`;
            }
            
            enemy.hp -= playerDamage;
            
            if (enemy.hp <= 0) {
                enemy.hp = 0;
                gameState.battleEnded = true;
                battleLog.innerHTML += `<p class="heal">ğŸ‰ ä½ å‡»è´¥äº† ${enemy.name}ï¼</p>`;
                const expGain = enemy.exp || 50;
                gainExp(expGain);
                battleLog.innerHTML += `<p class="info">ğŸ“ˆ è·å¾— ${expGain} ç»éªŒå€¼</p>`;
                document.getElementById('attack-btn').disabled = true;
                document.getElementById('heal-btn').disabled = true;
                document.getElementById('flee-btn').disabled = true;
                if (enemy.name === 'çš±çš®å¤§ç‹') {
                    gameState.bossDefeated = true;
                    gameState.defeatedBosses.add('çš±çš®å¤§ç‹');
                    setTimeout(() => gameOver(true), 2000);
                } else {
                    if (enemy.boss) {
                        gameState.defeatedBosses.add(enemy.name);
                        battleLog.innerHTML += `<p class="heal">â­ å‡»è´¥äº†å¼ºå¤§çš„Bossï¼</p>`;
                    }
                    if (enemy.reward) {
                        enemy.reward.forEach(itemId => {
                            const amount = Math.floor(Math.random() * 2) + 1;
                            addToInventory(itemId, amount);
                            battleLog.innerHTML += `<p class="heal">è·å¾— ${items[itemId].name} x${amount}</p>`;
                        });
                    }
                    setTimeout(() => endBattle(), 2000);
                }
                document.getElementById('enemy-hp').textContent = `0/${enemy.maxHp}`;
                battleLog.scrollTop = battleLog.scrollHeight;
                return;
            }
            
            let baseEnemyDamage = enemy.attack;
            let enemyDamage = baseEnemyDamage - (player.baseDefense + player.bonusDefense);
            enemyDamage = Math.max(Math.floor(baseEnemyDamage * 0.2), enemyDamage);
            
            if (enemy.name === 'çš±çš®å¤§ç‹' && Math.random() < 0.3) {
                enemyDamage = Math.floor(enemyDamage * 2);
                battleLog.innerHTML += `<p class="damage">ğŸŒ‘ çš±çš®å¤§ç‹ä½¿ç”¨äº†é‚ªæ¶èƒ½é‡ï¼Œé€ æˆ ${enemyDamage} ç‚¹ä¼¤å®³ï¼</p>`;
            } else if (enemy.name === 'é…·é…·çš„ç‹—' && Math.random() < 0.25) {
                enemyDamage = Math.floor(enemyDamage * 1.8);
                battleLog.innerHTML += `<p class="damage">ğŸ• é…·é…·çš„ç‹—å±•ç°å‡ºäº†å®ƒçš„é…·ç‚«åŠ›é‡ï¼Œé€ æˆ ${enemyDamage} ç‚¹ä¼¤å®³ï¼</p>`;
            }
            
            if (player.name === 'åˆ˜ä¸–é¹') enemyDamage = Math.floor(enemyDamage * 0.7);
            
            const dodgeChance = (player.agility || 0) / 100 + (player.name === 'ç™½ç‹' ? 0.25 : 0);
            if (Math.random() < dodgeChance) {
                battleLog.innerHTML += `<p class="heal">âœ¨ ä½ çµå·§åœ°é—ªé¿äº†æ”»å‡»ï¼</p>`;
            } else {
                player.hp -= enemyDamage;
                if (player.name === 'ç¥ç›¾' && enemyDamage > 0) {
                    const boost = Math.floor((player.baseAttack + player.bonusAttack) * 0.05);
                    player.attackBoost += boost;
                    battleLog.innerHTML += `<p class="info">ğŸ›¡ï¸ å—ä¼¤æ¿€å‘æ½œèƒ½ï¼æ”»å‡»åŠ›æå‡ ${boost} ç‚¹ï¼ˆæ€»è®¡ï¼š${player.baseAttack + player.bonusAttack + player.attackBoost}ï¼‰</p>`;
                }
                battleLog.innerHTML += `<p class="damage">ğŸ’¥ ${enemy.name} åå‡»ï¼Œé€ æˆ ${enemyDamage} ç‚¹ä¼¤å®³</p>`;
            }
            
            document.getElementById('enemy-hp').textContent = `${enemy.hp}/${enemy.maxHp}`;
            updateStatusBar();
            battleLog.scrollTop = battleLog.scrollHeight;
            
            if (player.hp <= 0) {
                gameState.battleEnded = true;
                document.getElementById('attack-btn').disabled = true;
                document.getElementById('heal-btn').disabled = true;
                document.getElementById('flee-btn').disabled = true;
                setTimeout(() => gameOver(false), 1000);
            }
        }

        function useHealItem() {
            if (!gameState.inBattle || gameState.battleEnded) return;
            const healItems = ['herb', 'potion', 'meat'];
            for (let itemId of healItems) {
                if (gameState.inventory[itemId] && gameState.inventory[itemId] > 0) {
                    activateAudioOnUserInteraction();
                    playClickSound();
                    useItem(itemId);
                    const battleLog = document.getElementById('battle-log');
                    battleLog.innerHTML += `<p class="heal">ğŸ’Š ä½¿ç”¨äº† ${items[itemId].name}</p>`;
                    const enemy = gameState.currentEnemy;
                    
                    let baseEnemyDamage = enemy.attack;
                    let enemyDamage = baseEnemyDamage - (gameState.player.baseDefense + gameState.player.bonusDefense);
                    enemyDamage = Math.max(Math.floor(baseEnemyDamage * 0.2), enemyDamage);
                    
                    if (gameState.player.name === 'åˆ˜ä¸–é¹') enemyDamage = Math.floor(enemyDamage * 0.7);
                    const dodgeChance = (gameState.player.agility || 0) / 100 + (gameState.player.name === 'ç™½ç‹' ? 0.25 : 0);
                    if (Math.random() < dodgeChance) {
                        battleLog.innerHTML += `<p class="heal">âœ¨ ä½ é—ªé¿äº†æ”»å‡»ï¼</p>`;
                    } else {
                        gameState.player.hp -= enemyDamage;
                        if (gameState.player.name === 'ç¥ç›¾' && enemyDamage > 0) {
                            const boost = Math.floor((gameState.player.baseAttack + gameState.player.bonusAttack) * 0.05);
                            gameState.player.attackBoost += boost;
                            battleLog.innerHTML += `<p class="info">ğŸ›¡ï¸ å—ä¼¤æ¿€å‘æ½œèƒ½ï¼æ”»å‡»åŠ›æå‡ ${boost} ç‚¹</p>`;
                        }
                        battleLog.innerHTML += `<p class="damage">ğŸ’¥ ${enemy.name} è¶æœºæ”»å‡»ï¼Œé€ æˆ ${enemyDamage} ç‚¹ä¼¤å®³</p>`;
                    }
                    updateStatusBar();
                    battleLog.scrollTop = battleLog.scrollHeight;
                    return;
                }
            }
            const battleLog = document.getElementById('battle-log');
            battleLog.innerHTML += `<p>âŒ æ²¡æœ‰å¯ç”¨çš„æ²»ç–—ç‰©å“ï¼</p>`;
        }

        function flee() {
            if (!gameState.inBattle || gameState.battleEnded) return;
            activateAudioOnUserInteraction();
            playClickSound();
            if (gameState.currentEnemy.name === 'çš±çš®å¤§ç‹') {
                const battleLog = document.getElementById('battle-log');
                battleLog.innerHTML += `<p class="damage">âš ï¸ æ— æ³•ä»çš±çš®å¤§ç‹é¢å‰é€ƒè·‘ï¼å®ƒçš„åŠ›é‡å®Œå…¨å°é”äº†è¿™ä¸ªç©ºé—´ï¼</p>`;
                return;
            }
            if (Math.random() < 0.6) {
                gameState.battleEnded = true;
                const battleLog = document.getElementById('battle-log');
                battleLog.innerHTML += `<p class="heal">ğŸƒ ä½ æˆåŠŸé€ƒè·‘äº†ï¼</p>`;
                document.getElementById('attack-btn').disabled = true;
                document.getElementById('heal-btn').disabled = true;
                document.getElementById('flee-btn').disabled = true;
                setTimeout(() => endBattle(), 1000);
            } else {
                const battleLog = document.getElementById('battle-log');
                battleLog.innerHTML += `<p class="damage">âŒ é€ƒè·‘å¤±è´¥ï¼</p>`;
                const enemy = gameState.currentEnemy;
                
                let baseEnemyDamage = enemy.attack;
                let enemyDamage = baseEnemyDamage - (gameState.player.baseDefense + gameState.player.bonusDefense);
                enemyDamage = Math.max(Math.floor(baseEnemyDamage * 0.2), enemyDamage);
                
                if (gameState.player.name === 'åˆ˜ä¸–é¹') enemyDamage = Math.floor(enemyDamage * 0.7);
                gameState.player.hp -= enemyDamage;
                if (gameState.player.name === 'ç¥ç›¾' && enemyDamage > 0) {
                    const boost = Math.floor((gameState.player.baseAttack + gameState.player.bonusAttack) * 0.05);
                    gameState.player.attackBoost += boost;
                    battleLog.innerHTML += `<p class="info">ğŸ›¡ï¸ å—ä¼¤æ¿€å‘æ½œèƒ½ï¼æ”»å‡»åŠ›æå‡ ${boost} ç‚¹</p>`;
                }
                battleLog.innerHTML += `<p class="damage">ğŸ’¥ ${enemy.name} è¿½å‡»ï¼Œé€ æˆ ${enemyDamage} ç‚¹ä¼¤å®³</p>`;
                updateStatusBar();
            }
        }

        function endBattle() {
            gameState.inBattle = false;
            gameState.currentEnemy = null;
            gameState.battleEnded = false;
            gameState.player.attackBoost = 0;
            document.getElementById('battle-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            playMusic('normal');
            addGameLog('æˆ˜æ–—ç»“æŸï¼Œä½ ç»§ç»­å‰è¿›...');
            checkAndUnlockLocations();
        }

        function backToGame() {
            activateAudioOnUserInteraction();
            playClickSound();
            document.getElementById('inventory-screen').classList.remove('active');
            document.getElementById('craft-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
        }

        function addToInventory(itemId, amount) {
            if (!gameState.inventory[itemId]) gameState.inventory[itemId] = 0;
            gameState.inventory[itemId] += amount;
        }

        function checkSurvival() {
            if (gameState.player.hunger <= 0) {
                gameState.player.hp -= 10;
                addGameLog('âš ï¸ ä½ å¤ªé¥¿äº†ï¼ŒæŸå¤±äº†10ç‚¹ç”Ÿå‘½å€¼ï¼');
            }
            if (gameState.player.thirst <= 0) {
                gameState.player.hp -= 15;
                addGameLog('âš ï¸ ä½ å£æ¸´éš¾è€ï¼ŒæŸå¤±äº†15ç‚¹ç”Ÿå‘½å€¼ï¼');
            }
            updateStatusBar();
        }

        function gameOver(victory) {
            document.querySelectorAll('.game-screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById('ending-screen').classList.add('active');
            const endingContent = document.getElementById('ending-content');
            if (victory) {
                endingContent.innerHTML = `
                    <h2 class="victory">ğŸŠ çœŸÂ·ç»“å±€ï¼šå¤ä»‡å®Œæˆ ğŸŠ</h2>
                    <p style="margin-bottom: 20px; color: #ffd54f;">
                        çš±çš®å¤§ç‹å‘å‡ºæœ€åçš„æƒ¨å«å£°ï¼Œé‚ªæ¶çš„åŠ›é‡ä»å®ƒä½“å†…æ¶ˆæ•£ã€‚<br>
                        åºå¤§çš„èº«èº¯è½°ç„¶å€’åœ°ï¼Œæ°¸å¤œå ¡å’å¼€å§‹å´©å¡Œï¼
                    </p>
                    <p style="margin-bottom: 20px;">
                        é»‘æš—è¢«å…‰æ˜é©±æ•£ï¼Œè¢«ç¦é”¢çš„çµé­‚è·å¾—äº†è§£è„±ã€‚<br>
                        ä½ ç«™åœ¨åºŸå¢Ÿä¸­ï¼Œç»ˆäºä¸ºä»™å®¶å†›çš„æ‰€æœ‰äººå¤äº†ä»‡ã€‚
                    </p>
                    <p style="margin-bottom: 20px;">
                        è™½ç„¶å®¶å›­å·²ç»æ— æ³•é‡å»ºï¼Œä½†çš±çš®å¤§ç‹çš„å¨èƒå½»åº•æ¶ˆé™¤äº†ã€‚<br>
                        æ–°çš„æ—¶ä»£å³å°†å¼€å§‹...
                    </p>
                    <p style="margin-bottom: 20px;">
                        ä½ çš„çœ¼ä¸­é—ªçƒç€æ³ªå…‰ã€‚åœ¨é£ä¸­ï¼Œä½ ä¼¼ä¹å¬åˆ°äº†æ‰€æœ‰å¤±å»çš„åŒä¼´åœ¨æ­Œå”±...
                    </p>
                    <div style="background: rgba(76, 175, 80, 0.2); padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <p style="color: #4caf50;"><strong>æ¸¸æˆç»Ÿè®¡</strong></p>
                        <p>è§’è‰²: ${gameState.player.name}</p>
                        <p>æœ€ç»ˆç­‰çº§: Lv.${gameState.player.level}</p>
                        <p>å­˜æ´»å›åˆ: ${gameState.turnsAlived}</p>
                        <p>æ¢ç´¢åœ°ç‚¹: ${gameState.unlockedLocations.size}/8 ä¸ª</p>
                        <p>æœ€ç»ˆæ”»å‡»åŠ›: ${gameState.player.baseAttack + gameState.player.bonusAttack}</p>
                        <p>æœ€ç»ˆé˜²å¾¡åŠ›: ${gameState.player.baseDefense + gameState.player.bonusDefense}</p>
                    </div>
                    <button class="btn btn-primary" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
                `;
            } else {
                endingContent.innerHTML = `
                    <h2 class="defeat">ğŸ’€ æ¸¸æˆç»“æŸ ğŸ’€</h2>
                    <p style="margin-bottom: 20px;">
                        ä½ çš„ç”Ÿå‘½å€¼å½’é›¶äº†...<br>
                        å¤ä»‡ä¹‹è·¯åˆ°æ­¤ä¸ºæ­¢ã€‚
                    </p>
                    <p style="color: #f44336; margin-bottom: 20px;">
                        ä½†æ˜¯ï¼Œä»™å®¶å†›çš„æ„å¿—ä¸ä¼šæ¶ˆäº¡ï¼<br>
                        æ€»ä¼šæœ‰äººç»§ç»­æˆ˜æ–—ä¸‹å»...
                    </p>
                    <div style="background: rgba(244, 67, 54, 0.2); padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <p style="color: #f44336;"><strong>æ¸¸æˆç»Ÿè®¡</strong></p>
                        <p>è§’è‰²: ${gameState.player.name}</p>
                        <p>è¾¾åˆ°ç­‰çº§: Lv.${gameState.player.level}</p>
                        <p>å­˜æ´»å›åˆ: ${gameState.turnsAlived}</p>
                        <p>è§£é”åœ°ç‚¹: ${gameState.unlockedLocations.size}/8 ä¸ª</p>
                        <p>æœ€åä½ç½®: ${locations.find(l => l.id === gameState.currentLocation).name}</p>
                    </div>
                    <button class="btn btn-danger" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
                `;
            }
        }

        window.onload = function() {
            initCharacterSelection();
        };
    </script>
</body>
</html>
